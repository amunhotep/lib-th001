EXECUTE BLOCK (
  Q_DATE_FROM TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_FROM
 ,Q_DATE_TO   TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_TO
 ,Q_CHECKAUTO TYPE OF COLUMN TABL$J_4.FLAG_COMMIT = ?CHECKAUTO
)RETURNS ( 
  DATE_FROM       TYPE OF COLUMN TABL$J_4.DATE_COMMIT
 ,DATE_TO         TYPE OF COLUMN TABL$J_4.DATE_COMMIT
 ,CHECKAUTO       TYPE OF COLUMN TABL$J_4.FLAG_COMMIT
 ,OBJ_ID          TYPE OF COLUMN TABL$J_1000156.TMC_ID
 ,OBJ_NAME        TYPE OF COLUMN VIEW$R_TMC_AUTO.NAME
 ,TMC_KM_MIN      TYPE OF COLUMN TABL$J_1000156.TMC_KM
 ,TMC_KM_MAX      TYPE OF COLUMN TABL$J_1000156.TMC_KM
 ,TMC_KM          TYPE OF COLUMN TABL$J_1000156.TMC_KM
 ,ORDERS1         TYPE OF COLUMN TABL$J_1000156.ORDERS1
 ,ORDERS2         TYPE OF COLUMN TABL$J_1000156.ORDERS2
 ,ORDERSTOTAL     TYPE OF COLUMN TABL$J_1000156.ORDERSTOTAL
 ,ORDERSRET       TYPE OF COLUMN TABL$J_1000156.ORDERSRET
 ,SALESPLAN       TYPE OF COLUMN TABL$J_1000156.SALESPLAN
 ,SALESREGIONSLEN TYPE OF COLUMN TABL$J_1000156.SALESREGIONSLEN
 ,SUMMED          TYPE OF COLUMN TABL$J_1000156.SUMMED
 ,SUMTAXES        TYPE OF COLUMN TABL$J_1000156.SUMTAXES
 ,SUMWASH         TYPE OF COLUMN TABL$J_1000156.SUMWASH
 ,SUMTAX          TYPE OF COLUMN TABL$J_1000156.SUMTAX
 ,SUMCHECK        TYPE OF COLUMN TABL$J_1000156.SUMCHECK
 ,SALESTOTAL      TYPE OF COLUMN TABL$J_1000156.SALESTOTAL
 ,SALESFACT       TYPE OF COLUMN TABL$J_1000156.SALESFACT
 ,SALESDIFF       TYPE OF COLUMN TABL$J_1000156.SALESDIFF
)AS
BEGIN 
  DATE_FROM  = :Q_DATE_FROM;
  DATE_TO    = :Q_DATE_TO;
  CHECKAUTO  = :Q_CHECKAUTO;
  TMC_KM_MIN = 0;
  TMC_KM_MAX = 0;
  TMC_KM     = 0;
  IF(:CHECKAUTO = 1)THEN
  FOR 
    SELECT J156.TMC_ID, (SELECT FIRST 1 COALESCE(T1.NAME,'') FROM VIEW$R_TMC_AUTO T1 WHERE (T1.ID = J156.TMC_ID) )
          ,COALESCE(MIN(J156.TMC_KM),0), COALESCE(MAX(J156.TMC_KM),0)
          ,COALESCE(SUM(J156.ORDERS1),0), COALESCE(SUM(J156.ORDERS2),0), COALESCE(SUM(J156.ORDERSTOTAL),0), COALESCE(SUM(J156.ORDERSRET),0)
          ,COALESCE(SUM(J156.SALESPLAN),0), COALESCE(SUM(J156.SALESREGIONSLEN),0)
          ,COALESCE(SUM(J156.SUMMED),0), COALESCE(SUM(J156.SUMTAXES),0), COALESCE(SUM(J156.SUMWASH),0), COALESCE(SUM(J156.SUMTAX),0)
          ,COALESCE(SUM(J156.SUMCHECK),0), COALESCE(SUM(J156.SALESTOTAL),0), COALESCE(SUM(J156.SALESFACT),0)
          ,COALESCE(SUM(J156.SALESDIFF),0)
    FROM   TABL$J_4 J, TABL$J_1000156 J156
    WHERE  (J.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (J.FLAG_COMMIT = 1)
      AND  (J.TYPE_ID     = 1000157)
      AND  (J156.J_ID     = J.ID)
    GROUP BY 2, 1
    INTO   :OBJ_ID, :OBJ_NAME
          ,:TMC_KM_MIN, :TMC_KM_MAX
          ,:ORDERS1, :ORDERS2, :ORDERSTOTAL, :ORDERSRET
          ,:SALESPLAN, :SALESREGIONSLEN
          ,:SUMMED, :SUMTAXES, :SUMWASH, :SUMTAX
          ,:SUMCHECK, :SALESTOTAL, :SALESFACT
          ,:SALESDIFF
  DO 
    BEGIN 
    TMC_KM = :TMC_KM_MAX - :TMC_KM_MIN;
    SUSPEND;
    END 

  IF(:CHECKAUTO = 0)THEN
  FOR 
    SELECT J156.WRK_ID, (SELECT FIRST 1 COALESCE(T1.NAME,'') FROM TABL$R_WRK T1 WHERE (T1.ID = J156.WRK_ID) )
          ,COALESCE(SUM(J156.ORDERS1),0), COALESCE(SUM(J156.ORDERS2),0), COALESCE(SUM(J156.ORDERSTOTAL),0), COALESCE(SUM(J156.ORDERSRET),0)
          ,COALESCE(SUM(J156.SALESPLAN),0), COALESCE(SUM(J156.SALESREGIONSLEN),0)
          ,COALESCE(SUM(J156.SUMMED),0), COALESCE(SUM(J156.SUMTAXES),0), COALESCE(SUM(J156.SUMWASH),0), COALESCE(SUM(J156.SUMTAX),0)
          ,COALESCE(SUM(J156.SUMCHECK),0), COALESCE(SUM(J156.SALESTOTAL),0), COALESCE(SUM(J156.SALESFACT),0)
          ,COALESCE(SUM(J156.SALESDIFF),0)
    FROM   TABL$J_4 J, TABL$J_1000156 J156
    WHERE  (J.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (J.FLAG_COMMIT = 1)
      AND  (J.TYPE_ID     = 1000157)
      AND  (J156.J_ID     = J.ID)
    GROUP BY 2, 1
    INTO   :OBJ_ID, :OBJ_NAME
          ,:ORDERS1, :ORDERS2, :ORDERSTOTAL, :ORDERSRET
          ,:SALESPLAN, :SALESREGIONSLEN
          ,:SUMMED, :SUMTAXES, :SUMWASH, :SUMTAX
          ,:SUMCHECK, :SALESTOTAL, :SALESFACT
          ,:SALESDIFF
  DO 
    BEGIN 
    SUSPEND;
    END 
END
