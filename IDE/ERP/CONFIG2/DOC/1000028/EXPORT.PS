{$IFNDEF PEAKTOP:GLOBAL_VARIABLES.INC}                 {$I PEAKTOP:GLOBAL_VARIABLES.INC}                 {$ENDIF}
{$IFNDEF PEAKTOP:COM/MICROSOFT/OFFICE/EXCEL/CONST.INC} {$I PEAKTOP:COM/MICROSOFT/OFFICE/EXCEL/CONST.INC} {$ENDIF}
{$IFNDEF PEAKTOP:COM/MICROSOFT/OFFICE/EXCEL/UTILS.INC} {$I PEAKTOP:COM/MICROSOFT/OFFICE/EXCEL/UTILS.INC} {$ENDIF}
const
  msg_erp_export_to_excel = 'Экспорт данных в Microsoft Excel';
  //============================================================================
  procedure DocExportToExcel(const J_ID:string);
  var
    lkTr           :TxFBTransaction;
    lkQrJrnl       :TxFBQuery;
    lkQrDoc        :TxFBQuery;
    lkQrEnt        :TxFBQuery;
    lkExcel        :Variant;
    lkWorkBook     :Variant;
    lkWorkSheet    :Variant;
    lkRangeName    :string;
    lkTopRow       :Integer;
    lkStr          :string;
    lkTotalWOAmount:Extended;
    lkTotalAmount  :Extended;
    lkTotal        :Extended;
  begin
    lkTr := TxFBTransaction.Create(nil);
    with lkTr do
      begin
      DefaultDataBase := FBdataBase;
      with Params do
        begin
        Clear;
        Add('isc_tpb_read_committed');
        Add('isc_tpb_read');
        Add('isc_tpb_rec_version');
        Add('isc_tpb_nowait');
        end;
      end;
    lkQrJrnl := TxFBQuery.Create(lkTr); 
    with lkQrJrnl do
      begin
      SQL.Text := StringsLoadFromFile( StrAbsolutePath('../1000014/EDITFULL_JRNL0001.SQL' , ScriptName) );
      Prepare;
      ParamByName('J_ID').AsString := J_ID;
      Open;
      end;
    lkQrDoc  := TxFBQuery.Create(lkTr);
    with lkQrDoc do
      begin
      SQL.Text := StringsLoadFromFile( StrAbsolutePath('../1000014/EDITFULL_D1000014S.SQL' , ScriptName) );
      Prepare;
      ParamByName('J_ID').AsString := J_ID;
      Open;
      end;
    lkQrEnt  := TxFBQuery.Create(lkTr);
    with lkQrEnt do
      begin
      SQL.Text := StringsLoadFromFile( StrAbsolutePath('../4/RPT_DEFAULT02.SQL' , ScriptName) );
      Prepare;
      ParamByName('J_ID').AsString := J_ID;
      Open;
      end;
    Dialogs.ProgressDlgSetProgress(0);
    Dialogs.ProgressDlgShow(msg_erp_export_to_excel+' (вызов Excel)');
    Dialogs.ProgressDlgSetProgress(0);
    lkExcel := CreateOleObject('Excel.Application');
    lkExcel.DisplayAlerts := false;
    lkExcel.Visible := False;
    lkExcel.Application.EnableEvents := False;
    Dialogs.ProgressDlgShow(msg_erp_export_to_excel+' (создание листа)');
    lkWorkBook  := lkExcel.WorkBooks.Add(-4167); // with one sheet  !!!
    if(lkWorkBook.WorkSheets.Count < 1)then
      lkWorkSheet := lkWorkBook.WorkSheets.Add()
     else 
      lkWorkSheet := lkWorkBook.WorkSheets[1];
    Dialogs.ProgressDlgShow(msg_erp_export_to_excel+' (установка параметров страницы)');
    lkWorkSheet.Name := lkQrJrnl.FieldByName('DOCNUMBERSTR').AsString;
    lkWorkSheet.PageSetup.Orientation  := MSEXCEL_xlPortrait;
    lkWorkSheet.PageSetup.LeftMargin   := 15;
    lkWorkSheet.PageSetup.RightMargin  := 15;
    lkWorkSheet.PageSetup.TopMargin    := 15;
    lkWorkSheet.PageSetup.BottomMargin := 15;
    lkWorkSheet.PageSetup.HeaderMargin := 0;
    lkWorkSheet.PageSetup.FooterMargin := 0;
    Dialogs.ProgressDlgShow(msg_erp_export_to_excel+' (экспорт заголовков отчета)');
    // processing captions
    lkWorkSheet.Columns[ 1].ColumnWidth := 4;
    lkWorkSheet.Columns[ 1].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkWorkSheet.Columns[ 2].ColumnWidth := 3;
    lkWorkSheet.Columns[ 2].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkWorkSheet.Columns[ 3].ColumnWidth := 4;
    lkWorkSheet.Columns[ 3].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkWorkSheet.Columns[ 4].ColumnWidth := 48;
    lkWorkSheet.Columns[ 4].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkWorkSheet.Columns[ 5].ColumnWidth := 3;
    lkWorkSheet.Columns[ 5].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkWorkSheet.Columns[ 6].ColumnWidth := 6;
    lkWorkSheet.Columns[ 6].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkWorkSheet.Columns[ 7].ColumnWidth := 4;
    lkWorkSheet.Columns[ 7].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkWorkSheet.Columns[ 8].ColumnWidth := 6;
    lkWorkSheet.Columns[ 8].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkWorkSheet.Columns[ 9].ColumnWidth := 8;
    lkWorkSheet.Columns[ 9].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);


    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(1)+':'+MSExcel_IntToColIndex(9)+IntToStr(1);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'ВИДАТКОВА НАКЛАДНА №'+lkQrJrnl.FieldByName('DOCNUMBERSTR').AsString+
                                                          ' від "'+FormatDateTime('dd.mm.yyyy', lkQrJrnl.FieldByName('DATE_COMMIT').AsDateTime)+'"р. ';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 14;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(2)+':'+MSExcel_IntToColIndex(3)+IntToStr(2);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Постачальник:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(2)+':'+MSExcel_IntToColIndex(9)+IntToStr(2);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrEnt.FieldByName('ENT_CS_NAME2').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 10;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(3)+':'+MSExcel_IntToColIndex(3)+IntToStr(3);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := '';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(3)+':'+MSExcel_IntToColIndex(9)+IntToStr(3);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'РНОКПП: '+lkQrEnt.FieldByName('ENT_CS_INN').AsString+
                                                          ', ЄДРПОУ: '+lkQrEnt.FieldByName('ENT_CS_EDRPOU').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(4)+':'+MSExcel_IntToColIndex(3)+IntToStr(4);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Юридична адреса:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(4)+':'+MSExcel_IntToColIndex(9)+IntToStr(4);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrEnt.FieldByName('ENT_CS_ADDR_NAME').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(5)+':'+MSExcel_IntToColIndex(3)+IntToStr(5);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Контакти:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkStr := 'Тел.:'+lkQrEnt.FieldByName('ENT_CS_PHONES').AsString;
    if(StrTrimAll(lkQrEnt.FieldByName('ENT_CS_URLS').AsString) <> '')then
      lkStr := lkStr + ', Сайт: '+ lkQrEnt.FieldByName('ENT_CS_URLS').AsString; 
    if(StrTrimAll(lkQrEnt.FieldByName('ENT_CS_EMAILS').AsString) <> '')then
      lkStr := lkStr + ', Елек.пошта: '+ lkQrEnt.FieldByName('ENT_CS_EMAILS').AsString; 
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(5)+':'+MSExcel_IntToColIndex(9)+IntToStr(5);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkStr;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(6)+':'+MSExcel_IntToColIndex(3)+IntToStr(6);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Платіжні реквізити:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(6)+':'+MSExcel_IntToColIndex(9)+IntToStr(6);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrEnt.FieldByName('BANK_NAME').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);

    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(8)+':'+MSExcel_IntToColIndex(3)+IntToStr(8);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Покупець:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(8)+':'+MSExcel_IntToColIndex(9)+IntToStr(8);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrJrnl.FieldByName('CS_NAME').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 10;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(9)+':'+MSExcel_IntToColIndex(3)+IntToStr(9);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := '';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(9)+':'+MSExcel_IntToColIndex(9)+IntToStr(9);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'РНОКПП: '+lkQrJrnl.FieldByName('CS_INN').AsString+
                                                          ', ЄДРПОУ: '+lkQrJrnl.FieldByName('CS_EDRPOU').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(10)+':'+MSExcel_IntToColIndex(3)+IntToStr(10);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Юридична адреса:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(10)+':'+MSExcel_IntToColIndex(9)+IntToStr(10);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrJrnl.FieldByName('CS_ADDR_ID_JURIDICAL').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := false;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(11)+':'+MSExcel_IntToColIndex(3)+IntToStr(11);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Пункт розвантаження:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(11)+':'+MSExcel_IntToColIndex(9)+IntToStr(11);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := lkQrJrnl.FieldByName('CS_ADDR_ID_').AsString;
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := True;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    

    lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(12)+':'+MSExcel_IntToColIndex(2)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := '№  з/п';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(3)+IntToStr(12)+':'+MSExcel_IntToColIndex(3)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Артикул';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(12)+':'+MSExcel_IntToColIndex(4)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Найменування';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(5)+IntToStr(12)+':'+MSExcel_IntToColIndex(5)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Од. Вим';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(6)+IntToStr(12)+':'+MSExcel_IntToColIndex(7)+IntToStr(12);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Кількість';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(6)+IntToStr(13)+':'+MSExcel_IntToColIndex(6)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Яш.';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(7)+IntToStr(13)+':'+MSExcel_IntToColIndex(7)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Шт.';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(8)+IntToStr(12)+':'+MSExcel_IntToColIndex(8)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Ціна (грн.)';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);
    lkRangeName := MSExcel_IntToColIndex(9)+IntToStr(12)+':'+MSExcel_IntToColIndex(9)+IntToStr(13);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Сума (грн.)';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taCenter);

    Dialogs.ProgressDlgShow(msg_erp_export_to_excel+' (выгрузка данных)');
    Dialogs.ProgressDlgSetProgress(0);
    lkTopRow := 14;
    lkQrDoc.First;
    while not lkQrDoc.EOF do
      begin
      lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(2)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := lkQrDoc.FieldByName('I').AsString;
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(3)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(3)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := lkQrDoc.FieldByName('TMC_ARTICLE').AsString;
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(4)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := lkQrDoc.FieldByName('TMC_NAME2').AsString;
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(5)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(5)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := lkQrDoc.FieldByName('TMC_EDIZM_SHORT').AsString;
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(6)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(6)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := lkQrDoc.FieldByName('QUANTORDER').AsString+' ('+lkQrDoc.FieldByName('TMC_ORDERQUANT').AsString+')';
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(7)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(7)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.###', lkQrDoc.FieldByName('QUANT').AsFloat);
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(8)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(8)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.00', lkQrDoc.FieldByName('PRICE').AsFloat);
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;

      lkRangeName := MSExcel_IntToColIndex(9)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.00', lkQrDoc.FieldByName('TOTALWOAMOUNT').AsFloat);
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;
      
      lkTotalWOAmount:= lkTotalWOAmount + lkQrDoc.FieldByName('TOTALWOAMOUNT').AsFloat;
      lkTotalAmount  := lkTotalAmount   + lkQrDoc.FieldByName('TOTALAMOUNT').AsFloat;
      lkTotal        := lkTotal         + lkQrDoc.FieldByName('TOTAL').AsFloat;
      lkTopRow := lkTopRow + 1;
      lkQrDoc.Next;
      Amunhotep.ProcessMessages;
      end;
    lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(8)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'ВСЬОГО:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkRangeName := MSExcel_IntToColIndex(9)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.00', lkTotalWOAmount);
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkTopRow := lkTopRow + 1;
    lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(8)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Знижка:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkRangeName := MSExcel_IntToColIndex(9)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.00', lkTotalAmount);
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkTopRow := lkTopRow + 1;
    lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(8)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'До сплати:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := $FFC0C0;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkRangeName := MSExcel_IntToColIndex(9)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := FormatFloat('# ### ##0.00', lkTotal);
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Verdana';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 7;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taRightJustify);
    lkRangeName := MSExcel_IntToColIndex(2)+IntToStr(12)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    MSExcel_DrawGridByRange(lkRangeName, lkWorkSheet);
    lkTopRow := lkTopRow + 1;
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(3)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Всього на суму:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := MoneyToStringFmt(lkTotal, valUkraine, langUkrainian, False);
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := True;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkTopRow := lkTopRow + 2;
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(4)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Уповноважений за проведення господарьскої операції від постачальника:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(5)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := '_______________ (__________________)';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkTopRow := lkTopRow + 2;
    lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(4)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := 'Уповноважений представник покупця:';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].WrapText            := True;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkRangeName := MSExcel_IntToColIndex(5)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
    lkWorkSheet.Range[lkRangeName].Merge;
    lkWorkSheet.Range[lkRangeName].Value               := '_______________ (__________________)';
    lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
    lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
    lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
    lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
    lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
    lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
    lkTopRow := lkTopRow + 4;
    if(StrTrimAll(lkQrJrnl.FieldByName('NAME').AsString)<>'')then
      begin
      lkRangeName := MSExcel_IntToColIndex(1)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Merge;
      lkWorkSheet.Range[lkRangeName].Value               := 'Примітки до документу:';
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := true;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;
      lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
      lkTopRow := lkTopRow + 1;
      lkRangeName := MSExcel_IntToColIndex(4)+IntToStr(lkTopRow)+':'+MSExcel_IntToColIndex(9)+IntToStr(lkTopRow);
      lkWorkSheet.Range[lkRangeName].Merge;
      lkWorkSheet.Range[lkRangeName].Value               := lkQrJrnl.FieldByName('NAME').AsString;
      lkWorkSheet.Range[lkRangeName].Font.Name           := 'Times New Roman';
      lkWorkSheet.Range[lkRangeName].Font.Size           := 8;
      lkWorkSheet.Range[lkRangeName].Font.Color          := clBlack;
      lkWorkSheet.Range[lkRangeName].Font.Bold           := False;
      lkWorkSheet.Range[lkRangeName].Interior.Color      := clWhite;
      lkWorkSheet.Range[lkRangeName].WrapText            := True;
      lkWorkSheet.Range[lkRangeName].HorizontalAlignment := MSExcel_AlignmentToHorizontalAlignment(taLeftJustify);
      end;
    if lkTr.InTransaction then
      lkTr.Commit;
    lkTr.Free;  

    Dialogs.ProgressDlgHide;
    Amunhotep.ProcessMessages;
    lkExcel.Application.EnableEvents := true;
    lkExcel.Visible := true;
  end;
  //============================================================================
var
  lkJ_ID :string;
begin
  lkJ_ID := GetGlobalVariable('J_ID');
  DocExportToExcel( lkJ_ID );
end.
