EXECUTE BLOCK (
  Q_CS_ID TYPE OF COLUMN TABL$R_CS.ID = ?CS_ID
)RETURNS (
  CS1_ID               TYPE OF COLUMN TABL$R_CS.ID,
  CS1_NAME             TYPE OF COLUMN TABL$R_CS.NAME,
  CS1_INN              TYPE OF COLUMN TABL$R_CS.INN,
  COUNTRY1_ID          TYPE OF COLUMN TABL$R_CS_ADDR.COUNTRY_ID,
  COUNTRY1_NAME        TYPE OF COLUMN TABL$R_COUNTRIES.NAME,
  REGION1_ID           TYPE OF COLUMN TABL$R_CS_ADDR.REGION_ID,
  REGION1_NAME         TYPE OF COLUMN TABL$R_REGIONS.NAME,
  ADDRESS1_ID          TYPE OF COLUMN TABL$R_CS_ADDR.ID,
  ADDRESS1_ZIP         TYPE OF COLUMN TABL$R_CS_ADDR.ZIP,
  ADDRESS1_NAME        TYPE OF COLUMN TABL$R_CS_ADDR.NAME,
  ADDRESS1_PHONES      TYPE OF COLUMN TABL$R_CS_ADDR.NAME,
  CS1_DOC_ID           TYPE OF COLUMN TABL$R_CS_DOCS.ID,
  CS1_DOC_DOCTYPE_ID   TYPE OF COLUMN TABL$R_CS_DOCS.DOCTYPE_ID,
  CS1_DOC_DOCTYPE_NAME TYPE OF COLUMN TABL$R_WRK_DOCTYPES.NAME,
  CS1_DOC_NAME         TYPE OF COLUMN TABL$R_CS_DOCS.NAME,
  CS1_DOC_DOC_SERIAL   TYPE OF COLUMN TABL$R_CS_DOCS.DOC_SERIAL,
  CS1_DOC_DOC_NUMBER   TYPE OF COLUMN TABL$R_CS_DOCS.DOC_NUMBER,
  CS1_DOC_DOC_DATE     TYPE OF COLUMN TABL$R_CS_DOCS.DOC_DATE,
  CS1_DOC_DOC_DATEEND  TYPE OF COLUMN TABL$R_CS_DOCS.DOC_DATEEND,
  CS2_ID               TYPE OF COLUMN TABL$R_CS.ID,
  CS2_NAME             TYPE OF COLUMN TABL$R_CS.NAME,
  CS2_INN              TYPE OF COLUMN TABL$R_CS.INN,
  COUNTRY2_ID          TYPE OF COLUMN TABL$R_CS_ADDR.COUNTRY_ID,
  COUNTRY2_NAME        TYPE OF COLUMN TABL$R_COUNTRIES.NAME,
  REGION2_ID           TYPE OF COLUMN TABL$R_CS_ADDR.REGION_ID,
  REGION2_NAME         TYPE OF COLUMN TABL$R_REGIONS.NAME,
  ADDRESS2_ID          TYPE OF COLUMN TABL$R_CS_ADDR.ID,
  ADDRESS2_ZIP         TYPE OF COLUMN TABL$R_CS_ADDR.ZIP,
  ADDRESS2_NAME        TYPE OF COLUMN TABL$R_CS_ADDR.NAME,
  ADDRESS2_PHONES      TYPE OF COLUMN TABL$R_CS_ADDR.NAME,
  CS2_DOC_ID           TYPE OF COLUMN TABL$R_CS_DOCS.ID,
  CS2_DOC_DOCTYPE_ID   TYPE OF COLUMN TABL$R_CS_DOCS.DOCTYPE_ID,
  CS2_DOC_DOCTYPE_NAME TYPE OF COLUMN TABL$R_WRK_DOCTYPES.NAME,
  CS2_DOC_NAME         TYPE OF COLUMN TABL$R_CS_DOCS.NAME,
  CS2_DOC_DOC_SERIAL   TYPE OF COLUMN TABL$R_CS_DOCS.DOC_SERIAL,
  CS2_DOC_DOC_NUMBER   TYPE OF COLUMN TABL$R_CS_DOCS.DOC_NUMBER,
  CS2_DOC_DOC_DATE     TYPE OF COLUMN TABL$R_CS_DOCS.DOC_DATE,
  CS2_DOC_DOC_DATEEND  TYPE OF COLUMN TABL$R_CS_DOCS.DOC_DATEEND)
AS
  DECLARE VARIABLE P_CS_ADDR_ID TYPE OF COLUMN TABL$R_CS_ADDR.ID;
  DECLARE VARIABLE P_CNTR       TYPE OF COLUMN TABL$R_CS_ADDR.ID;
BEGIN
  -- COMMON INFORMATION
  SELECT FIRST 1 C1.ID, C1.NAME, C1.INN
  FROM   TABL$R_CS C1
  WHERE  (C1.ID = :Q_CS_ID)
  INTO   :CS1_ID, :CS1_NAME, :CS1_INN;
  -- DEFAULT ADDRESS
  SELECT FIRST 1 CSA.ID FROM TABL$R_CS_ADDR CSA WHERE(CSA.CS_ID = :CS1_ID) INTO :P_CS_ADDR_ID;
  SELECT FIRST 1 CSA.ID, CSA.ZIP, CSA.NAME, CNTR.ID, CNTR.NAME, REGN.ID, REGN.NAME
  FROM   TABL$R_CS_ADDR CSA, TABL$R_COUNTRIES CNTR, TABL$R_REGIONS REGN
  WHERE  (CSA.ID  = :P_CS_ADDR_ID)
    AND  (CNTR.ID = CSA.COUNTRY_ID)
    AND  (REGN.ID = CSA.REGION_ID)
  INTO   :ADDRESS1_ID, :ADDRESS1_ZIP, :ADDRESS1_NAME, :COUNTRY1_ID, :COUNTRY1_NAME, :REGION1_ID, :REGION1_NAME;
  -- PHONES
  SELECT LIST(P.NAME, '; ')
  FROM   TABL$R_CS_PHONES P
  WHERE  (P.CS_ID = :CS1_ID)
  INTO   :ADDRESS1_PHONES;
  -- DEFAULT DOCUMENT
  SELECT FIRST 1 CD.ID, CD.DOCTYPE_ID, DT.NAME, CD.NAME, CD.DOC_SERIAL, CD.DOC_NUMBER
        ,CD.DOC_DATE, CD.DOC_DATEEND
  FROM   TABL$R_CS_DOCS CD, TABL$R_WRK_DOCTYPES DT
  WHERE  (CD.CS_ID = :CS1_ID)
    AND  (DT.ID = CD.DOCTYPE_ID)
  INTO   :CS1_DOC_ID, :CS1_DOC_DOCTYPE_ID, :CS1_DOC_DOCTYPE_NAME, :CS1_DOC_NAME
        ,:CS1_DOC_DOC_SERIAL, :CS1_DOC_DOC_NUMBER,:CS1_DOC_DOC_DATE,:CS1_DOC_DOC_DATEEND;

  P_CNTR = 0;
  FOR
    SELECT DISTINCT L.CS_CHILD_ID
    FROM   TABL$R_CS_LINKS L
    WHERE  (L.CS_ID = :CS1_ID)
      AND  ((L.LINKTYPE_ID+0) = 1000004)
    INTO   :CS2_ID
  DO
    BEGIN
    -- COMMON INFORMATION
    SELECT FIRST 1 C2.NAME, C2.INN
    FROM   TABL$R_CS C2
    WHERE  (C2.ID = :CS2_ID)
    INTO   :CS2_NAME, :CS2_INN;
    -- DEFAULT ADDRESS
    SELECT FIRST 1 CSA.ID FROM TABL$R_CS_ADDR CSA WHERE(CSA.CS_ID = :CS2_ID) INTO :P_CS_ADDR_ID;
    SELECT FIRST 1 CSA.ID, CSA.ZIP, CSA.NAME, CNTR.ID, CNTR.NAME, REGN.ID, REGN.NAME
    FROM   TABL$R_CS_ADDR CSA, TABL$R_COUNTRIES CNTR, TABL$R_REGIONS REGN
    WHERE  (CSA.ID  = :P_CS_ADDR_ID)
      AND  (CNTR.ID = CSA.COUNTRY_ID)
      AND  (REGN.ID = CSA.REGION_ID)
    INTO   :ADDRESS2_ID, :ADDRESS2_ZIP, :ADDRESS2_NAME, :COUNTRY2_ID, :COUNTRY2_NAME, :REGION2_ID, :REGION2_NAME;
    -- PHONES
    SELECT LIST(P.NAME, '; ')
    FROM   TABL$R_CS_PHONES P
    WHERE  (P.CS_ID = :CS2_ID)
    INTO   :ADDRESS2_PHONES;
    -- DEFAULT DOCUMENT
    SELECT FIRST 1 CD.ID, CD.DOCTYPE_ID, DT.NAME, CD.NAME, CD.DOC_SERIAL, CD.DOC_NUMBER
          ,CD.DOC_DATE, CD.DOC_DATEEND
    FROM   TABL$R_CS_DOCS CD, TABL$R_WRK_DOCTYPES DT
    WHERE  (CD.CS_ID = :CS2_ID)
      AND  (DT.ID = CD.DOCTYPE_ID)
    INTO   :CS2_DOC_ID, :CS2_DOC_DOCTYPE_ID, :CS2_DOC_DOCTYPE_NAME, :CS2_DOC_NAME
          ,:CS2_DOC_DOC_SERIAL, :CS2_DOC_DOC_NUMBER,:CS2_DOC_DOC_DATE,:CS2_DOC_DOC_DATEEND;

    SUSPEND;
    P_CNTR = :P_CNTR + 1;
    END
  IF(:P_CNTR = 0)THEN SUSPEND;
END
