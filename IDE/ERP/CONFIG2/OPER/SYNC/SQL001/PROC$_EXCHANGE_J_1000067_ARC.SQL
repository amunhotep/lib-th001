CREATE OR ALTER PROCEDURE PROC$_EXCHANGE_J_1000067_ARC (
  Q_DATABASEPATH TYPE OF COLUMN TABL$R_FILIALS.DATABASE_NAME,
  Q_USERNAME     TYPE OF COLUMN TABL$_USERS.ID,
  Q_USERPWD      TYPE OF COLUMN TABL$_USERS.PWD,
  Q_FILIAL_ID    TYPE OF COLUMN TABL$R_FILIALS.ID,
  Q_J_ID         TYPE OF COLUMN TABL$J_4.ID)
RETURNS (
  TYPE_ID TYPE OF COLUMN TABL$_TB_TYPES.ID,
  NAME    TYPE OF COLUMN TABL$_TB.NAME,
  CNT     TYPE OF COLUMN TABL$J_4.ID)
AS
  DECLARE VARIABLE P_DOCSUMCALC TYPE OF COLUMN TABL$J_1000067.DOCSUMCALC;
BEGIN
  TYPE_ID = 1000067;
  CNT     = 0;
  SELECT FIRST 1 TB.NAME FROM TABL$_TB_TYPES TB WHERE(TB.ID = :TYPE_ID) INTO :NAME;

  FOR
    EXECUTE STATEMENT 'SELECT FIRST 1 JC.DOCSUMCALC FROM TABL$J_1000067 JC WHERE (JC.J_ID = '''||:Q_J_ID||''') '
      ON EXTERNAL DATA SOURCE :Q_DATABASEPATH AS USER :Q_USERNAME PASSWORD :Q_USERPWD WITH AUTONOMOUS TRANSACTION
    INTO :P_DOCSUMCALC
  DO
    BEGIN
    UPDATE OR INSERT INTO TABL$J_1000067(J_ID, DOCSUMCALC) VALUES (:Q_J_ID, :P_DOCSUMCALC) MATCHING (J_ID);
    CNT = :CNT + 1;
    END
  NAME = '    +-- PROC$_EXCHANGE_J_1000067_ARC ('||:Q_J_ID||')';
  SUSPEND;

  FOR
    SELECT P1000014.TYPE_ID, P1000014.NAME, P1000014.CNT
    FROM   PROC$_EXCHANGE_D_1000014_ARC(:Q_DATABASEPATH, :Q_USERNAME, :Q_USERPWD, :Q_FILIAL_ID, :Q_J_ID) P1000014
    INTO   :TYPE_ID, :NAME, :CNT
  DO
    SUSPEND;
END
