EXECUTE BLOCK (
   Q_OBJ_ID     TYPE OF COLUMN TABL$_TB.ID           = ?OBJ_ID
  ,Q_OBJ_TYPE   TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID = ?OBJ_TYPE
  ,Q_ROLE_ID    TYPE OF COLUMN TABL$_USERS_ROLES.ID  = ?ROLE_ID
  ,Q_FLAG_SEL   TYPE OF COLUMN TABL$_TB.FLAG_DELETE  = ?FLAG_SEL
  ,Q_FLAG_INS   TYPE OF COLUMN TABL$_TB.FLAG_DELETE  = ?FLAG_INS
  ,Q_FLAG_UPD   TYPE OF COLUMN TABL$_TB.FLAG_DELETE  = ?FLAG_UPD
  ,Q_FLAG_DEL   TYPE OF COLUMN TABL$_TB.FLAG_DELETE  = ?FLAG_DEL
  ,Q_FLAG_PRINT TYPE OF COLUMN TABL$_TB.FLAG_DELETE  = ?FLAG_PRINT
)
AS
  DECLARE VARIABLE P_POS         TYPE OF COLUMN TABL$_TB.DLG_HEIGHT;
  DECLARE VARIABLE P_ROLE_ID     TYPE OF COLUMN TABL$_USERS_ROLES.ID;
  DECLARE VARIABLE P_ACCSS       TYPE OF COLUMN TABL$_TB.ACCSS;
  DECLARE VARIABLE P_ACCSS_INS   TYPE OF COLUMN TABL$_TB.ACCSS_INS;
  DECLARE VARIABLE P_ACCSS_UPD   TYPE OF COLUMN TABL$_TB.ACCSS_UPD;
  DECLARE VARIABLE P_ACCSS_DEL   TYPE OF COLUMN TABL$_TB.ACCSS_DEL;
  DECLARE VARIABLE P_ACCSS_PRINT TYPE OF COLUMN TABL$_TB.ACCSS_PRINT;
BEGIN
  SELECT FIRST 1 T.ACCSS, T.ACCSS_INS, T.ACCSS_UPD, T.ACCSS_DEL, T.ACCSS_PRINT
  FROM   TABL$_TB T
  WHERE  (T.ID = :Q_OBJ_ID)
  INTO   :P_ACCSS, :P_ACCSS_INS, :P_ACCSS_UPD, :P_ACCSS_DEL, :P_ACCSS_PRINT;
  IF(:P_ACCSS       IS NULL)THEN P_ACCSS       = '~';
  IF(:P_ACCSS_INS   IS NULL)THEN P_ACCSS_INS   = '~';
  IF(:P_ACCSS_UPD   IS NULL)THEN P_ACCSS_UPD   = '~';
  IF(:P_ACCSS_DEL   IS NULL)THEN P_ACCSS_DEL   = '~';
  IF(:P_ACCSS_PRINT IS NULL)THEN P_ACCSS_PRINT = '~';
  FOR SELECT R.ID FROM TABL$_USERS_ROLES R WHERE((R.ID = :Q_ROLE_ID)OR(:Q_ROLE_ID < 0)) ORDER BY R.ID INTO :P_ROLE_ID DO
    BEGIN
    IF(:Q_FLAG_SEL >= 0)THEN
      BEGIN
      IF(:Q_FLAG_SEL = 1)THEN
        BEGIN
        IF(:P_ACCSS NOT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          IF(SUBSTRING(:P_ACCSS FROM CHAR_LENGTH(:P_ACCSS) FOR 1) <> '~')THEN
            P_ACCSS = :P_ACCSS||'~';
          P_ACCSS = :P_ACCSS||:P_ROLE_ID||'~';
          END
        END
       ELSE
        BEGIN
        IF(:P_ACCSS CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS);
          WHILE(:P_POS > 0)DO
            BEGIN
            P_ACCSS = SUBSTRING(:P_ACCSS FROM 1 FOR (:P_POS - 1)) || SUBSTRING(:P_ACCSS FROM (:P_POS + CHAR_LENGTH('~'||:P_ROLE_ID)));
            P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS);
            END
          END
        END
      END
    IF(:Q_FLAG_INS >= 0)THEN
      BEGIN
      IF(:Q_FLAG_INS = 1)THEN
        BEGIN
        IF(:P_ACCSS_INS NOT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          IF(SUBSTRING(:P_ACCSS_INS FROM CHAR_LENGTH(:P_ACCSS_INS) FOR 1) <> '~')THEN
            P_ACCSS_INS = :P_ACCSS_INS||'~';
          P_ACCSS_INS = :P_ACCSS_INS||:P_ROLE_ID||'~';
          END
        END
       ELSE
        BEGIN
        IF(:P_ACCSS_INS CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_INS);
          WHILE(:P_POS > 0)DO
            BEGIN
            P_ACCSS_INS = SUBSTRING(:P_ACCSS_INS FROM 1 FOR (:P_POS - 1)) || SUBSTRING(:P_ACCSS_INS FROM (:P_POS + CHAR_LENGTH('~'||:P_ROLE_ID)));
            P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_INS);
            END
          END
        END
      END
    IF(:Q_FLAG_UPD >= 0)THEN
      BEGIN
      IF(:Q_FLAG_UPD = 1)THEN
        BEGIN
        IF(:P_ACCSS_UPD NOT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          IF(SUBSTRING(:P_ACCSS_UPD FROM CHAR_LENGTH(:P_ACCSS_UPD) FOR 1) <> '~')THEN
            P_ACCSS_UPD = :P_ACCSS_UPD||'~';
          P_ACCSS_UPD = :P_ACCSS_UPD||:P_ROLE_ID||'~';
          END
        END
       ELSE
        BEGIN
        IF(:P_ACCSS_UPD CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_UPD);
          WHILE(:P_POS > 0)DO
            BEGIN
            P_ACCSS_UPD = SUBSTRING(:P_ACCSS_UPD FROM 1 FOR (:P_POS - 1)) || SUBSTRING(:P_ACCSS_UPD FROM (:P_POS + CHAR_LENGTH('~'||:P_ROLE_ID)));
            P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_UPD);
            END
          END
        END
      END
    IF(:Q_FLAG_DEL >= 0)THEN
      BEGIN
      IF(:Q_FLAG_DEL = 1)THEN
        BEGIN
        IF(:P_ACCSS_DEL NOT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          IF(SUBSTRING(:P_ACCSS_DEL FROM CHAR_LENGTH(:P_ACCSS_DEL) FOR 1) <> '~')THEN
            P_ACCSS_DEL = :P_ACCSS_DEL||'~';
          P_ACCSS_DEL = :P_ACCSS_DEL||:P_ROLE_ID||'~';
          END
        END
       ELSE
        BEGIN
        IF(:P_ACCSS_DEL CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_DEL);
          WHILE(:P_POS > 0)DO
            BEGIN
            P_ACCSS_DEL = SUBSTRING(:P_ACCSS_DEL FROM 1 FOR (:P_POS - 1)) || SUBSTRING(:P_ACCSS_DEL FROM (:P_POS + CHAR_LENGTH('~'||:P_ROLE_ID)));
            P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_DEL);
            END
          END
        END
      END
    IF(:Q_FLAG_PRINT >= 0)THEN
      BEGIN
      IF(:Q_FLAG_PRINT = 1)THEN
        BEGIN
        IF(:P_ACCSS_PRINT NOT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          IF(SUBSTRING(:P_ACCSS_PRINT FROM CHAR_LENGTH(:P_ACCSS_PRINT) FOR 1) <> '~')THEN
            P_ACCSS_PRINT = :P_ACCSS_PRINT||'~';
          P_ACCSS_PRINT = :P_ACCSS_PRINT||:P_ROLE_ID||'~';
          END
        END
       ELSE
        BEGIN
        IF(:P_ACCSS_PRINT CONTAINING '~'||:P_ROLE_ID||'~')THEN
          BEGIN
          P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_PRINT);
          WHILE(:P_POS > 0)DO
            BEGIN
            P_ACCSS_PRINT = SUBSTRING(:P_ACCSS_PRINT FROM 1 FOR (:P_POS - 1)) || SUBSTRING(:P_ACCSS_PRINT FROM (:P_POS + CHAR_LENGTH('~'||:P_ROLE_ID)));
            P_POS = POSITION('~'||:P_ROLE_ID||'~' IN :P_ACCSS_PRINT);
            END
          END
        END
      END
    END
  UPDATE TABL$_TB T SET
     T.ACCSS       = :P_ACCSS
    ,T.ACCSS_INS   = :P_ACCSS_INS
    ,T.ACCSS_UPD   = :P_ACCSS_UPD
    ,T.ACCSS_DEL   = :P_ACCSS_DEL
    ,T.ACCSS_PRINT = :P_ACCSS_PRINT
  WHERE (T.ID = :Q_OBJ_ID);
END
