EXECUTE BLOCK RETURNS (
  CNT TYPE OF COLUMN TABL$_TB_TYPES.ID
)AS
  DECLARE VARIABLE P_FIRM_ID       TYPE OF COLUMN TABL$R_FIRMS.ID;
  DECLARE VARIABLE P_TYPE_ID       TYPE OF COLUMN TABL$_TB_DOCS.ID;
  DECLARE VARIABLE P_GENR_NAME     TYPE OF COLUMN TABL$_TB_DOCS.GENR_NAME;
  DECLARE VARIABLE P_SQL_STMT      TYPE OF COLUMN TABL$_EXCHANGE_SQL.SRC;
begin
  CNT  = 0;
  FOR
    SELECT TD.ID, TD.GENR_NAME
    FROM   TABL$_TB_DOCS TD
    ORDER BY TD.ID
    INTO   :P_TYPE_ID, :P_GENR_NAME
  DO
    FOR SELECT F1.ID FROM TABL$R_FIRMS F1 INTO :P_FIRM_ID DO
      BEGIN
      P_GENR_NAME = 'GENR$J_NUMBER_'||:P_TYPE_ID;

      UPDATE TABL$_TB_DOCS TD1 SET
        TD1.GENR_NAME = :P_GENR_NAME
      WHERE (TD1.ID = :P_TYPE_ID);

      P_GENR_NAME = 'GENR$J_NUMBER_'||:P_TYPE_ID||'_'||:P_FIRM_ID;

      IF(NOT(EXISTS(SELECT G1.RDB$GENERATOR_ID FROM RDB$GENERATORS G1 WHERE (TRIM(G1.RDB$GENERATOR_NAME) = :P_GENR_NAME))))THEN
        BEGIN
        P_SQL_STMT  = 'CREATE GENERATOR '||:P_GENR_NAME;
        EXECUTE STATEMENT :P_SQL_STMT;
        P_SQL_STMT  = 'SET GENERATOR '||:P_GENR_NAME||' TO 0 ';
        EXECUTE STATEMENT :P_SQL_STMT;
        CNT = :CNT + 1;
        END
      END
  SUSPEND;
END
