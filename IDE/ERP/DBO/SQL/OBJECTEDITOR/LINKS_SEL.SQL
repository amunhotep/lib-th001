EXECUTE BLOCK (
   Q_OBJ_ID       TYPE OF COLUMN TABL$_TB.ID           = ?OBJ_ID
  ,Q_OBJ_TYPE     TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID = ?OBJ_TYPE
)RETURNS (
   OBJ_ID         TYPE OF COLUMN TABL$_TB.ID
  ,OBJ_TYPE       TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID
  ,TYPE_ID        TYPE OF COLUMN TABL$_TB.TYPE_ID
  ,TYPE_NAME      TYPE OF COLUMN TABL$_TB_TYPES.NAME
  ,TYPE_PATH      DOMN$PSTRING_8192
  ,BASE_TYPE_ID   TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID
  ,IMG_INDX       TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID
  ,ID             TYPE OF COLUMN TABL$_TB.ID
  ,NAME           TYPE OF COLUMN TABL$_TB.NAME
  ,FLAG_MASTER    TYPE OF COLUMN TABL$_TB.FLAG_MASTER
  ,TC_ID          TYPE OF COLUMN TABL$_TB_COLS.ID
  ,TC_NAME        TYPE OF COLUMN TABL$_TB_COLS.NAME
  ,TC_FLAG        TYPE OF COLUMN TABL$_TB_COLS.FLAG_DELETE
)AS
BEGIN
  OBJ_ID   = :Q_OBJ_ID;
  OBJ_TYPE = :Q_OBJ_TYPE;
  FOR
    SELECT TB.BASE_TYPE_ID, TB.TYPE_ID, T.NAME AS TYPE_NAME, TC.TB_ID, TB.NAME AS TB_NAME, TC.ID, TC.NAME, TC.FLAG_DELETE, TB.FLAG_MASTER
    FROM   TABL$_TB_COLS TC, TABL$_TB TB, TABL$_TB_TYPES T
    WHERE  ( (TRIM(TC.REF_TABLE) = :Q_OBJ_ID) OR (TC.CALC_SQL CONTAINING :Q_OBJ_ID) )
      AND  (TB.ID = TC.TB_ID)
      AND  (T.ID = TB.TYPE_ID)
    ORDER BY TB.BASE_TYPE_ID, TB.NAME, TC.NAME
    INTO   :BASE_TYPE_ID, :TYPE_ID, :TYPE_NAME, :ID, :NAME, :TC_ID, :TC_NAME, :TC_FLAG, :FLAG_MASTER
  DO
    BEGIN
    WITH RECURSIVE TTT AS(
      SELECT FIRST 1 T1.ID, T1.PARENT_ID, '"'||T1.NAME||'"' AS NAME FROM TABL$_TB_TYPES T1 WHERE (T1.ID = :TYPE_ID)
      UNION ALL
      SELECT FIRST 1 T2.ID, T2.PARENT_ID, '"'||T2.NAME||'" / '||T3.NAME AS NAME FROM TABL$_TB_TYPES T2, TTT T3 WHERE (T2.ID = T3.PARENT_ID)
    )SELECT FIRST 1 R.NAME FROM TTT R WHERE (R.ID = :BASE_TYPE_ID) INTO :TYPE_PATH;
    IMG_INDX = :BASE_TYPE_ID;
    IF(:BASE_TYPE_ID = 4)THEN
      BEGIN
      IF(:FLAG_MASTER = 1)THEN IMG_INDX = :BASE_TYPE_ID + 10;
      END
    SUSPEND;
    END
END
