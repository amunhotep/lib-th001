EXECUTE BLOCK(
   Q_TYPE_ID   TYPE OF COLUMN TABL$_TB_TYPES.ID = ?TYPE_ID
  ,Q_ID        TYPE OF COLUMN TABL$R_FIRMS.ID   = ?ID
)RETURNS(
   TYPE_ID        TYPE OF COLUMN TABL$_TB_TYPES.ID
  ,TYPE_GENR      TYPE OF COLUMN TABL$_TB_TYPES.NAME
  ,FLAG_EXISTS    TYPE OF COLUMN TABL$R_FIRMS.FLAG_DELETE
  ,ID             TYPE OF COLUMN TABL$R_FIRMS.ID
  ,NAME           TYPE OF COLUMN TABL$R_FIRMS.NAME
  ,GENR_NAME      TYPE OF COLUMN TABL$R_FIRMS.NAME
  ,GENR_VALUE     TYPE OF COLUMN TABL$R_FIRMS.ID
  ,NUM_PREFIX     TYPE OF COLUMN TABL$_TB_DOCS.NUM_PREFIX
  ,COLOR_FRG      TYPE OF COLUMN TABL$_TB_DOCS.COLOR_FRG
  ,COLOR_BGR      TYPE OF COLUMN TABL$_TB_DOCS.COLOR_BGR
  ,COLOR_FRG_HTML TYPE OF COLUMN TABL$_TB_DOCS.COLOR_FRG_HTML
  ,COLOR_BGR_HTML TYPE OF COLUMN TABL$_TB_DOCS.COLOR_BGR_HTML
)AS
  DECLARE VARIABLE P_SQL TYPE OF COLUMN TABL$R_FIRMS.NAME;
BEGIN
  TYPE_ID = :Q_TYPE_ID;

  SELECT FIRST 1 T.GENR_NAME, T.NUM_PREFIX, T.COLOR_FRG, T.COLOR_BGR, T.COLOR_FRG_HTML, T.COLOR_BGR_HTML
  FROM   TABL$_TB_DOCS T
  WHERE  (T.ID = :TYPE_ID)
  INTO   :TYPE_GENR, :NUM_PREFIX, :COLOR_FRG, :COLOR_BGR, :COLOR_FRG_HTML, :COLOR_BGR_HTML;

  SELECT FIRST 1 F.ID, F.NAME
  FROM   TABL$R_FIRMS F
  WHERE  (F.ID = :Q_ID)
  ORDER BY F.ID
  INTO  :ID, :NAME;

  FLAG_EXISTS = 0;
  GENR_VALUE  = 0;
  GENR_NAME   = :TYPE_GENR||'_'||:ID;
  IF(EXISTS(
    SELECT G.RDB$GENERATOR_ID
    FROM   RDB$GENERATORS G
    WHERE  (TRIM(G.RDB$GENERATOR_NAME) = :GENR_NAME)
  ))THEN FLAG_EXISTS = 1;
  IF(:FLAG_EXISTS = 1)THEN
    BEGIN
    P_SQL = 'SELECT FIRST 1 GEN_ID('||:GENR_NAME||', 0) FROM RDB$DATABASE ';
    EXECUTE STATEMENT :P_SQL INTO :GENR_VALUE;
    END
  SUSPEND;
END
