EXECUTE BLOCK
AS
  DECLARE VARIABLE P_BASETYPE    TYPE OF COLUMN TABL$_TB.BASE_TYPE_ID;
  DECLARE VARIABLE P_OBJ_ID      TYPE OF COLUMN TABL$_TB_DOCSRPT.OBJ_ID;
  DECLARE VARIABLE P_FOLDER      TYPE OF COLUMN TABL$_TB_DOCSRPT.OBJ_ID;
  DECLARE VARIABLE P_ID          TYPE OF COLUMN TABL$_TB_DOCSRPT.ID;
  DECLARE VARIABLE P_NAME        TYPE OF COLUMN TABL$_TB_DOCSRPT.NAME;
  DECLARE VARIABLE P_FLAG_DELETE TYPE OF COLUMN TABL$_TB_DOCSRPT.FLAG_DELETE;
  DECLARE VARIABLE P_ORDERID     TYPE OF COLUMN TABL$_TB_DOCSRPT.ORDERID;
  DECLARE VARIABLE P_SUBTYPE     TYPE OF COLUMN TABL$_TB_DOCSRPT.SUBTYPE;
  DECLARE VARIABLE P_PATH        TYPE OF COLUMN TABL$_TB_DOCSRPT.PATH;
  DECLARE VARIABLE P_DESCR       TYPE OF COLUMN TABL$_TB_DOCSRPT.DESCR;
BEGIN
  P_FLAG_DELETE = 0;
  FOR
    SELECT UPPER(TRIM(TMP.ID)), TMP.NAME, TMP.BASE_TYPE_ID
    FROM   TABL$_TB TMP
    WHERE  (TMP.BASE_TYPE_ID IN (2,6))
    ORDER BY TMP.ID
    INTO :P_OBJ_ID, :P_NAME, :P_BASETYPE
  DO
    BEGIN
    P_FOLDER = :P_OBJ_ID;
    IF(POSITION('TABL$' IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 6);
    IF(POSITION('PROC$' IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 6);
    IF(POSITION('VIEW$' IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 6);
    IF(POSITION('R_'    IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 3);
    IF(POSITION('P_'    IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 3);
    IF(POSITION('J_'    IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 3);
    IF(POSITION('D_'    IN :P_FOLDER) = 1)THEN P_FOLDER = SUBSTRING(:P_FOLDER FROM 3);
    -- LIST
    P_PATH    = '';
    P_DESCR   = '  '||:P_NAME;
    P_SUBTYPE = 1;
    P_ORDERID = 0;
    IF(:P_BASETYPE = 2)THEN
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REF/RPT_0000.XFM';
     ELSE
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REG/RPT_0000.XFM';
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPT(OBJ_ID, NAME, FLAG_DELETE, ORDERID, SUBTYPE, PATH, DESCR, ACCSS)
      VALUES(:P_OBJ_ID, 'Общий шаблон', :P_FLAG_DELETE, :P_ORDERID, :P_SUBTYPE, :P_PATH, '  Общий шаблон', NULL)
      MATCHING(OBJ_ID, ORDERID, SUBTYPE)
      RETURNING ID INTO :P_ID;
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPTSQL(RPT_ID, NAME, PARENT, FLAG_DELETE, ORDERID, PATH)
      VALUES (:P_ID, 'qrMain', '', 0, 0, 'CURRENT_QUERY')
      MATCHING(RPT_ID, NAME, PARENT, ORDERID, PATH);

    P_PATH    = '';
    P_DESCR   = '  '||:P_NAME;
    P_SUBTYPE = 1;
    P_ORDERID = 1;
    IF(:P_BASETYPE = 2)THEN
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REF/RPT0001.XFM';
     ELSE
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REG/RPT0001.XFM';
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPT(OBJ_ID, NAME, FLAG_DELETE, ORDERID, SUBTYPE, PATH, DESCR, ACCSS)
      VALUES(:P_OBJ_ID, 'Общий шаблон в две колонки', :P_FLAG_DELETE, :P_ORDERID, :P_SUBTYPE, :P_PATH, '  Общий шаблон в две колонки', NULL)
      MATCHING(OBJ_ID, ORDERID, SUBTYPE)
      RETURNING ID INTO :P_ID;
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPTSQL(RPT_ID, NAME, PARENT, FLAG_DELETE, ORDERID, PATH)
      VALUES (:P_ID, 'qrMain', '', 0, 0, 'CURRENT_QUERY')
      MATCHING(RPT_ID, NAME, PARENT, ORDERID, PATH);

    P_PATH    = '';
    P_DESCR   = '  '||:P_NAME;
    P_SUBTYPE = 1;
    P_ORDERID = 2;
    IF(:P_BASETYPE = 2)THEN
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REF/'||:P_FOLDER||'/RPT0000.XFM';
     ELSE
      P_PATH = 'PEAKTOP:IDE/ERP/CONFIG2/REG/'||:P_FOLDER||'/RPT0000.XFM';
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPT(OBJ_ID, NAME, FLAG_DELETE, ORDERID, SUBTYPE, PATH, DESCR, ACCSS)
      VALUES(:P_OBJ_ID, :P_NAME, :P_FLAG_DELETE, :P_ORDERID, :P_SUBTYPE, :P_PATH, :P_DESCR, NULL)
      MATCHING(OBJ_ID, ORDERID, SUBTYPE)
      RETURNING ID INTO :P_ID;
    UPDATE OR INSERT INTO TABL$_TB_DOCSRPTSQL(RPT_ID, NAME, PARENT, FLAG_DELETE, ORDERID, PATH)
      VALUES (:P_ID, 'qrMain', '', 0, 0, 'CURRENT_QUERY')
      MATCHING(RPT_ID, NAME, PARENT, ORDERID, PATH);
    END
END
