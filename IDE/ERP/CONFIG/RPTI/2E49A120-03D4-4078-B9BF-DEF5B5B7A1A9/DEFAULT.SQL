EXECUTE BLOCK (
   Q_DATE_FROM TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_FROM
  ,Q_DATE_TO   TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_TO
  ,Q_FIRM_IDS  TYPE OF COLUMN TABL$J_4.DOCSTR      = ?FIRM_IDS
)RETURNS ( 
   DATE_FROM   TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,DATE_TO     TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,FIRM_IDS    TYPE OF COLUMN TABL$J_4.DOCSTR
  ,FLAG_DEBET  TYPE OF COLUMN TABL$J_4.FLAG_COMMIT
  ,FLAG_MAIN   TYPE OF COLUMN TABL$J_4.FLAG_COMMIT
  ,NAME        TYPE OF COLUMN TABL$J_4.NAME
  ,SUBKONTO    TYPE OF COLUMN TABL$J_4.DOCSTR
  ,SMAIN       TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S1000001    TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S1000002    TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S1000003    TYPE OF COLUMN TABL$J_4.DOCSUM
  ,PMAIN       TYPE OF COLUMN TABL$J_4.DOCSUM
  ,P1000001    TYPE OF COLUMN TABL$J_4.DOCSUM
  ,P1000002    TYPE OF COLUMN TABL$J_4.DOCSUM
  ,P1000003    TYPE OF COLUMN TABL$J_4.DOCSUM
)AS
  DECLARE VARIABLE P_SUBKONTO  TYPE OF COLUMN TABL$P_CND.SUBKONTO_ID_DEB;
  DECLARE VARIABLE P_SMAIN     TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_S1000001  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_S1000002  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_S1000003  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_PMAIN     TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_P1000001  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_P1000002  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_P1000003  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_JMAIN     TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_J1000001  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_J1000002  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_J1000003  TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P1_SMAIN    TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P1_S1000001 TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P1_S1000002 TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P1_S1000003 TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P2_SMAIN    TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P2_S1000001 TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P2_S1000002 TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P2_S1000003 TYPE OF COLUMN TABL$J_4.DOCSUM;
BEGIN 
  DATE_FROM = :Q_DATE_FROM;
  DATE_TO   = :Q_DATE_TO;
  FIRM_IDS  = :Q_FIRM_IDS;

  SELECT COALESCE(SUM(JF.DOCSUM), 0) 
  FROM   TABL$J_4 JF 
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.TYPE_ID       =  1000075) 
    AND  (JF.FLAG_COMMIT   = 1) 
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :P_SMAIN;
  SELECT COALESCE(SUM(JF.DOCSUM), 0) 
  FROM   TABL$J_4 JF 
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.TYPE_ID       =  1000075) 
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = '1000001') 
    AND  (JF.FLAG_COMMIT   = 1) 
  INTO   :P_S1000001;
  SELECT COALESCE(SUM(JF.DOCSUM), 0) 
  FROM   TABL$J_4 JF 
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.TYPE_ID       =  1000075) 
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = '1000002') 
    AND  (JF.FLAG_COMMIT   = 1) 
  INTO   :P_S1000002;
  SELECT COALESCE(SUM(JF.DOCSUM), 0) 
  FROM   TABL$J_4 JF 
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.TYPE_ID       =  1000075) 
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = '1000003') 
    AND  (JF.FLAG_COMMIT   = 1) 
  INTO   :P_S1000003;
  FLAG_DEBET = 1;
  FLAG_MAIN  = 1;
  NAME       = 'Продажи (Доход)';
  SUBKONTO   = '';
  SMAIN      = :P_SMAIN;
  S1000001   = :P_S1000001;
  S1000002   = :P_S1000002;
  S1000003   = :P_S1000003;
  PMAIN      = 100;
  P1000001   = 100;
  P1000002   = 100;
  P1000003   = 100;
  SUSPEND;

  SELECT COALESCE(SUM(P1.J_POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    = 0)
  INTO   :P_JMAIN;
  SELECT COALESCE(SUM(P1.J_POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    = 0)
    AND  ((P1.FILIAL_ID+0)= 1000001) 
  INTO   :P_J1000001;
  SELECT COALESCE(SUM(P1.J_POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    = 0)
    AND  ((P1.FILIAL_ID+0)= 1000002) 
  INTO   :P_J1000002;
  SELECT COALESCE(SUM(P1.J_POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    = 0)
    AND  ((P1.FILIAL_ID+0)= 1000003) 
  INTO   :P_J1000003;
  FLAG_DEBET = 2;
  FLAG_MAIN  = 1;
  NAME       = 'Заработанно гостями баллов';
  SUBKONTO   = '(расходы будущих периодов)';
  SMAIN      = :P_JMAIN;
  S1000001   = :P_J1000001;
  S1000002   = :P_J1000002;
  S1000003   = :P_J1000003;
  PMAIN      = 0; IF(:P_SMAIN    <> 0)THEN PMAIN    = (:P_JMAIN    * 100) / :P_SMAIN;
  P1000001   = 0; IF(:P_S1000001 <> 0)THEN P1000001 = (:P_J1000001 * 100) / :P_S1000001;
  P1000002   = 0; IF(:P_S1000002 <> 0)THEN P1000002 = (:P_J1000002 * 100) / :P_S1000002;
  P1000003   = 0; IF(:P_S1000003 <> 0)THEN P1000003 = (:P_J1000003 * 100) / :P_S1000003;
  SUSPEND;

  SELECT COALESCE(SUM(P1.POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    <> 0)
  INTO   :P_PMAIN;
  SELECT COALESCE(SUM(P1.POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    <> 0)
    AND  ((P1.FILIAL_ID+0)= 1000001) 
  INTO   :P_P1000001;
  SELECT COALESCE(SUM(P1.POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    <> 0)
    AND  ((P1.FILIAL_ID+0)= 1000002) 
  INTO   :P_P1000002;
  SELECT COALESCE(SUM(P1.POINTS), 0)
  FROM   TABL$P_CS_RSPOINTS P1
  WHERE  (P1.J_DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
    AND  (P1.PARENT_ID    = 0)
    AND  ((P1.FILIAL_ID+0)= 1000003) 
  INTO   :P_P1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  NAME       = 'Потрачено гостями баллов';
  SUBKONTO   = '(расходы по скидкам)';
  SMAIN      = :P_PMAIN;
  S1000001   = :P_P1000001;
  S1000002   = :P_P1000002;
  S1000003   = :P_P1000003;
  PMAIN      = 0; IF(:P_SMAIN    <> 0)THEN PMAIN    = (:P_PMAIN    * 100) / :P_SMAIN;
  P1000001   = 0; IF(:P_S1000001 <> 0)THEN P1000001 = (:P_P1000001 * 100) / :P_S1000001;
  P1000002   = 0; IF(:P_S1000002 <> 0)THEN P1000002 = (:P_P1000002 * 100) / :P_S1000002;
  P1000003   = 0; IF(:P_S1000003 <> 0)THEN P1000003 = (:P_P1000003 * 100) / :P_S1000003;
  SUSPEND;

  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB  = 631)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :P1_SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB  = 631)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :P1_S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB  = 631)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :P1_S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB  = 631)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :P1_S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  NAME       = '631.Оплата за товар';
  SUBKONTO   = '';
  SMAIN      = :P1_SMAIN;
  S1000001   = :P1_S1000001;
  S1000002   = :P1_S1000002;
  S1000003   = :P1_S1000003;
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB, JF.SUBKONTO_NAME_DEB
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB  = 631)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY JF.SUBKONTO_NAME_DEB, JF.SUBKONTO_ID_DEB
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB  = 631)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB  = 631)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB  = 631)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB  = 631)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END
  FLAG_DEBET = 2;
  FLAG_MAIN  = 1;
  NAME       = 'Прибыль грязная';
  SUBKONTO   = '';
  SMAIN      = (:P_SMAIN    - :P_PMAIN    - :P1_SMAIN);
  S1000001   = (:P_S1000001 - :P_P1000001 - :P1_S1000001);
  S1000002   = (:P_S1000002 - :P_P1000002 - :P1_S1000002);
  S1000003   = (:P_S1000003 - :P_P1000003 - :P1_S1000003);
  PMAIN      = 100; IF(:P_SMAIN    <> 0)THEN PMAIN    = (:P_SMAIN    - :P_PMAIN    - :P1_SMAIN   ) * 100 / :P_SMAIN;
  P1000001   = 100; IF(:P_S1000001 <> 0)THEN P1000001 = (:P_S1000001 - :P_P1000001 - :P1_S1000001) * 100 / :P_S1000001;
  P1000002   = 100; IF(:P_S1000002 <> 0)THEN P1000002 = (:P_S1000002 - :P_P1000002 - :P1_S1000002) * 100 / :P_S1000002;
  P1000003   = 100; IF(:P_S1000003 <> 0)THEN P1000003 = (:P_S1000003 - :P_P1000003 - :P1_S1000003) * 100 / :P_S1000003;
  SUSPEND;
  ---------------- 66
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  NAME       = '66,661,6611.Зарплата';
  SUBKONTO   = '';
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB, JF.SUBKONTO_NAME_DEB
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB IN (66,661,6611))
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY JF.SUBKONTO_NAME_DEB, JF.SUBKONTO_ID_DEB
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB IN (66,661,6611))
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB IN (66,661,6611))
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB IN (66,661,6611))
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB IN (66,661,6611))
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END
  ------ 91
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 91)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 91)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 91)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 91)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  SELECT FIRST 1 COALESCE(BA.NAME, '91') FROM TABL$R_BUHG_ACCS BA WHERE (BA.ID = 91) INTO :NAME;
  SUBKONTO   = '';
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB
          ,(SELECT FIRST 1 P.PATH FROM PROC$R_EXPENSES_PATH(JF.SUBKONTO_ID_DEB,'') P)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB = 91)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY 2,1
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 91)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 91)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 91)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 91)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END
  ------ 92
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 92)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 92)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 92)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 92)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  SELECT FIRST 1 COALESCE(BA.NAME, '92') FROM TABL$R_BUHG_ACCS BA WHERE (BA.ID = 92) INTO :NAME;
  SUBKONTO   = '';
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB
          ,(SELECT FIRST 1 P.PATH FROM PROC$R_EXPENSES_PATH(JF.SUBKONTO_ID_DEB,'') P)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB = 92)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY 2,1
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 92)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 92)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 92)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 92)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END
  ------ 93
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 93)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 93)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 93)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 93)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  SELECT FIRST 1 COALESCE(BA.NAME, '93') FROM TABL$R_BUHG_ACCS BA WHERE (BA.ID = 93) INTO :NAME;
  SUBKONTO   = '';
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB
          ,(SELECT FIRST 1 P.PATH FROM PROC$R_EXPENSES_PATH(JF.SUBKONTO_ID_DEB,'') P)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB = 93)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY 2,1
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 93)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 93)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 93)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 93)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END
  ------ 641
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 641)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 641)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 641)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB = 641)
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :S1000003;
  FLAG_DEBET = 0;
  FLAG_MAIN  = 1;
  SELECT FIRST 1 COALESCE(BA.NAME, '641') FROM TABL$R_BUHG_ACCS BA WHERE (BA.ID = 641) INTO :NAME;
  SUBKONTO   = '';
  IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
  IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
  IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
  IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
  SUSPEND;
  FOR
    SELECT JF.SUBKONTO_ID_DEB, JF.SUBKONTO_NAME_DEB
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO)
      AND  (JF.ACC_ID_DEB = 641)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    GROUP BY 2,1
    INTO   :P_SUBKONTO, :SUBKONTO
  DO
    BEGIN
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 641)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :SMAIN;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 641)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000001)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000001;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 641)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000002)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000002;
    SELECT COALESCE(SUM(JF.CND_VALUE), 0)
    FROM   TABL$P_CND JF
    WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
      AND  (JF.ACC_ID_DEB = 641)
      AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
      AND  ((JF.FILIAL_ID+0) = 1000003)
      AND  (JF.SUBKONTO_ID_DEB = :P_SUBKONTO)
    INTO   :S1000003;
    FLAG_DEBET = 0;
    FLAG_MAIN  = 0;
    IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :SMAIN)    * 100 / :P_SMAIN;    ELSE PMAIN    = 0;
    IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :S1000001) * 100 / :P_S1000001; ELSE P1000001 = 0;
    IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :S1000002) * 100 / :P_S1000002; ELSE P1000002 = 0;
    IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :S1000003) * 100 / :P_S1000003; ELSE P1000003 = 0;
    SUSPEND;
    END

  ---------------- TOTAL
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611,91,92,93,641))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
  INTO   :P2_SMAIN;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611,91,92,93,641))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000001)
  INTO   :P2_S1000001;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611,91,92,93,641))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000002)
  INTO   :P2_S1000002;
  SELECT COALESCE(SUM(JF.CND_VALUE), 0)
  FROM   TABL$P_CND JF
  WHERE  (JF.DATE_COMMIT BETWEEN :DATE_FROM AND :DATE_TO) 
    AND  (JF.ACC_ID_DEB IN (66,661,6611,91,92,93,641))
    AND  (:FIRM_IDS CONTAINING '~'||JF.FIRM_ID||'~')
    AND  ((JF.FILIAL_ID+0) = 1000003)
  INTO   :P2_S1000003;
  FLAG_DEBET = 2;
  FLAG_MAIN  = 1;
  NAME       = 'Всего расходов';
  SUBKONTO   = '';
  SMAIN      = :P2_SMAIN;
  S1000001   = :P2_S1000001;
  S1000002   = :P2_S1000002;
  S1000003   = :P2_S1000003;
  PMAIN      = 0; IF(:P_SMAIN    <> 0)THEN PMAIN    = 100 - (:P_SMAIN    - :P2_SMAIN)    * 100 / :P_SMAIN;
  P1000001   = 0; IF(:P_S1000001 <> 0)THEN P1000001 = 100 - (:P_S1000001 - :P2_S1000001) * 100 / :P_S1000001;
  P1000002   = 0; IF(:P_S1000002 <> 0)THEN P1000002 = 100 - (:P_S1000002 - :P2_S1000002) * 100 / :P_S1000002;
  P1000003   = 0; IF(:P_S1000003 <> 0)THEN P1000003 = 100 - (:P_S1000003 - :P2_S1000003) * 100 / :P_S1000003;
  SUSPEND;

  FLAG_DEBET = 2;
  FLAG_MAIN  = 1;
  NAME       = 'Прибыль чистая';
  SUBKONTO   = '';
  SMAIN      = (:P_SMAIN    - :P_PMAIN    - :P1_SMAIN    - :P2_SMAIN);
  S1000001   = (:P_S1000001 - :P_P1000001 - :P1_S1000001 - :P2_S1000001);
  S1000002   = (:P_S1000002 - :P_P1000002 - :P1_S1000002 - :P2_S1000002);
  S1000003   = (:P_S1000003 - :P_P1000003 - :P1_S1000003 - :P2_S1000003);
  PMAIN      = 0; IF(:P_SMAIN    <> 0)THEN PMAIN    = (:P_SMAIN    - :P_PMAIN    - :P1_SMAIN    - :P2_SMAIN)    * 100 / :P_SMAIN;
  P1000001   = 0; IF(:P_S1000001 <> 0)THEN P1000001 = (:P_S1000001 - :P_P1000001 - :P1_S1000001 - :P2_S1000001) * 100 / :P_S1000001;
  P1000002   = 0; IF(:P_S1000002 <> 0)THEN P1000002 = (:P_S1000002 - :P_P1000002 - :P1_S1000002 - :P2_S1000002) * 100 / :P_S1000002;
  P1000003   = 0; IF(:P_S1000003 <> 0)THEN P1000003 = (:P_S1000003 - :P_P1000003 - :P1_S1000003 - :P2_S1000003) * 100 / :P_S1000003;
  SUSPEND;
END
