EXECUTE BLOCK (
   Q_DATERPT      TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATERPT
  ,Q_DATEYEAR     TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATEYEAR
  ,Q_FIRM_ID      TYPE OF COLUMN TABL$J_4.FIRM_ID     = ?FIRM_ID
)RETURNS(
   DATERPT        TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,DATEYEAR       TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,FIRM_ID        TYPE OF COLUMN TABL$J_4.FIRM_ID
  ,PLACE_ID       TYPE OF COLUMN TABL$R_PLACES.ID
  ,COUNTRY_ID     TYPE OF COLUMN TABL$R_COUNTRIES.ID
  ,COUNTRY_VALUTE TYPE OF COLUMN TABL$R_COUNTRIES.VALUTE
  ,MASSA_BEG_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_BEG      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_DEB_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_DEB      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR1_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR1      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR2_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR2      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR3_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KR3      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KRD_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_KRD      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_END_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,MASSA_END      TYPE OF COLUMN TABL$J_4.DOCSUM
)AS
BEGIN
  DATERPT  = :Q_DATERPT;
  DATEYEAR = :Q_DATEYEAR;
  FIRM_ID  = :Q_FIRM_ID;
  PLACE_ID = 1000002;

  FOR SELECT C.ID, C.VALUTE FROM TABL$R_COUNTRIES C WHERE (C.ID >= 1000086) INTO :COUNTRY_ID, :COUNTRY_VALUTE DO
    BEGIN
    MASSA_BEG_  = 0; MASSA_BEG   = 0;
    MASSA_DEB_  = 0; MASSA_DEB   = 0;
    MASSA_KR1_  = 0; MASSA_KR1   = 0;
    MASSA_KR2_  = 0; MASSA_KR2   = 0;
    MASSA_KR3_  = 0; MASSA_KR3   = 0;
    MASSA_KRD_  = 0; MASSA_KRD   = 0;
    MASSA_END_  = 0; MASSA_END   = 0;
    SELECT SUM(TMP.MASSA_NETTO), SUM(TMP.MASSA_LIG)
    FROM   (SELECT P.MASSA_NETTO
                 ,(SELECT FIRST 1 P1.MASSA_LIGAT FROM PROC$O_ENT_PS_MASSA_LIG(P.PROBE, P.MASSA_NETTO) P1) AS MASSA_LIG
            FROM  PROC$P_TMC_QUANT_PS(:FIRM_ID, :PLACE_ID, :DATEYEAR, 1) P
            WHERE (P.COUNTRY_ID = :COUNTRY_ID)
            )TMP
    INTO  :MASSA_BEG_, :MASSA_BEG;
    SELECT SUM(TMP.QUANT * TMP.MASSA_NETTO), SUM(TMP.QUANT * TMP.MASSA_LIG)
    FROM   (SELECT TM.QUANT, TMC.MASSA_NETTO, (SELECT FIRST 1 P1.MASSA_LIGAT
                     FROM PROC$O_ENT_PS_MASSA_LIG(TMC.PROBE, TMC.MASSA_NETTO) P1
                   )AS MASSA_LIG
            FROM   TABL$P_TMC_QUANT_MOVE TM, TABL$J_4 J, TABL$R_TMC TMC
            WHERE  (((TM.FIRM_ID+0) = :FIRM_ID) OR (:FIRM_ID < 0))
              AND  (TM.PLACE_ID = :PLACE_ID)
              AND  (TM.FLAG_DEBET = 1)
              AND  (J.ID = TM.J_ID)
              AND  (J.DATE_COMMIT >= :DATEYEAR)
              AND  (J.DATE_COMMIT <= :DATERPT)
              AND  (TMC.ID = TM.TMC_ID)
              AND  (TMC.COUNTRY_ID = :COUNTRY_ID)
            ) TMP
    INTO   :MASSA_DEB_, :MASSA_DEB;
    SELECT SUM(TMP.QUANT * TMP.MASSA_NETTO), SUM(TMP.QUANT * TMP.MASSA_LIG)
    FROM   (SELECT TM.QUANT, TMC.MASSA_NETTO, (SELECT FIRST 1 P1.MASSA_LIGAT
                     FROM PROC$O_ENT_PS_MASSA_LIG(TMC.PROBE, TMC.MASSA_NETTO) P1
                   )AS MASSA_LIG
            FROM   TABL$P_TMC_QUANT_MOVE TM, TABL$J_4 J, TABL$R_TMC TMC, TABL$J_1000014 J14
            WHERE  (((TM.FIRM_ID+0) = :FIRM_ID) OR (:FIRM_ID <0))
              AND  (TM.PLACE_ID = :PLACE_ID)
              AND  (TM.FLAG_DEBET = 0)
              AND  (J.ID = TM.J_ID)
              AND  (J.DATE_COMMIT >= :DATEYEAR)
              AND  (J.DATE_COMMIT <= :DATERPT)
              AND  (J14.J_ID  = J.ID)
              AND  (J14.CS_ID = 5)
              AND  (TMC.ID = TM.TMC_ID)
              AND  (TMC.COUNTRY_ID = :COUNTRY_ID)
            ) TMP
    INTO   :MASSA_KR1_, :MASSA_KR1;
    SELECT SUM(TMP.QUANT * TMP.MASSA_NETTO), SUM(TMP.QUANT * TMP.MASSA_LIG)
    FROM   (SELECT TM.QUANT, TMC.MASSA_NETTO, (SELECT FIRST 1 P1.MASSA_LIGAT
                     FROM PROC$O_ENT_PS_MASSA_LIG(TMC.PROBE, TMC.MASSA_NETTO) P1
                   )AS MASSA_LIG
            FROM   TABL$P_TMC_QUANT_MOVE TM, TABL$J_4 J, TABL$R_TMC TMC, TABL$J_1000014 J14
            WHERE  (((TM.FIRM_ID+0) = :FIRM_ID) OR (:FIRM_ID <0))
              AND  (TM.PLACE_ID = :PLACE_ID)
              AND  (TM.FLAG_DEBET = 0)
              AND  (J.ID = TM.J_ID)
              AND  (J.DATE_COMMIT >= :DATEYEAR)
              AND  (J.DATE_COMMIT <= :DATERPT)
              AND  (J14.J_ID  = J.ID)
              AND  (J14.CS_ID = 1)
              AND  (TMC.ID = TM.TMC_ID)
              AND  (TMC.COUNTRY_ID = :COUNTRY_ID)
            ) TMP
    INTO   :MASSA_KR2_, :MASSA_KR2;
    SELECT SUM(TMP.QUANT * TMP.MASSA_NETTO), SUM(TMP.QUANT * TMP.MASSA_LIG)
    FROM   (SELECT TM.QUANT, TMC.MASSA_NETTO, (SELECT FIRST 1 P1.MASSA_LIGAT
                     FROM PROC$O_ENT_PS_MASSA_LIG(TMC.PROBE, TMC.MASSA_NETTO) P1
                   )AS MASSA_LIG
            FROM   TABL$P_TMC_QUANT_MOVE TM, TABL$J_4 J, TABL$R_TMC TMC, TABL$J_1000014 J14
            WHERE  (((TM.FIRM_ID+0) = :FIRM_ID) OR (:FIRM_ID <0))
              AND  (TM.PLACE_ID = :PLACE_ID)
              AND  (TM.FLAG_DEBET = 0)
              AND  (J.ID = TM.J_ID)
              AND  (J.DATE_COMMIT >= :DATEYEAR)
              AND  (J.DATE_COMMIT <= :DATERPT)
              AND  (J14.J_ID  = J.ID)
              AND  (J14.CS_ID IN (-3,2,4))
              AND  (TMC.ID = TM.TMC_ID)
              AND  (TMC.COUNTRY_ID = :COUNTRY_ID)
            ) TMP
    INTO   :MASSA_KR3_, :MASSA_KR3;
    IF(:MASSA_BEG_ IS NULL)THEN MASSA_BEG_ = 0;
    IF(:MASSA_BEG  IS NULL)THEN MASSA_BEG  = 0;
    IF(:MASSA_DEB_ IS NULL)THEN MASSA_DEB_ = 0;
    IF(:MASSA_DEB  IS NULL)THEN MASSA_DEB  = 0;
    IF(:MASSA_KR1_ IS NULL)THEN MASSA_KR1_ = 0;
    IF(:MASSA_KR1  IS NULL)THEN MASSA_KR1  = 0;
    IF(:MASSA_KR2_ IS NULL)THEN MASSA_KR2_ = 0;
    IF(:MASSA_KR2  IS NULL)THEN MASSA_KR2  = 0;
    IF(:MASSA_KR3_ IS NULL)THEN MASSA_KR3_ = 0;
    IF(:MASSA_KR3  IS NULL)THEN MASSA_KR3  = 0;
    IF(:MASSA_KRD_ IS NULL)THEN MASSA_KRD_ = 0;
    IF(:MASSA_KRD  IS NULL)THEN MASSA_KRD  = 0;
    MASSA_KRD_ = :MASSA_KR1_ + :MASSA_KR2_ + :MASSA_KR3_;
    MASSA_KRD  = :MASSA_KR1  + :MASSA_KR2  + :MASSA_KR3;
    MASSA_END_ = :MASSA_BEG_ + :MASSA_DEB_ - :MASSA_KRD_;
    MASSA_END  = :MASSA_BEG  + :MASSA_DEB  - :MASSA_KRD ;
--    IF( (:MASSA_BEG <> 0) OR (:MASSA_DEB <> 0) OR (:MASSA_KR1 <> 0) OR (:MASSA_KR2 <> 0)
--       OR (:MASSA_KR3 <> 0) OR (:MASSA_END <> 0))THEN 
       SUSPEND;
    END
END
