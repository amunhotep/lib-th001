EXECUTE BLOCK(
   Q_DATE_FROM   TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_FROM
  ,Q_DATE_TO     TYPE OF COLUMN TABL$J_4.DATE_COMMIT = ?DATE_TO
  ,Q_FIRM_IDS    TYPE OF COLUMN TABL$J_4.DOCSTR      = ?FIRM_IDS
)RETURNS(
   DATE_FROM     TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,DATE_TO       TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,DATE_COMMIT   TYPE OF COLUMN TABL$J_4.DATE_COMMIT
  ,FIRM_IDS      TYPE OF COLUMN TABL$J_4.DOCSTR
  ,S3771BEG      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771DEB      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771KRD      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771KRD_     TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771END      TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771END_10   TYPE OF COLUMN TABL$J_4.DOCSUM
  ,S3771IDX      TYPE OF COLUMN TABL$J_4.DOCSUM
)AS
  DECLARE VARIABLE P_DEB TYPE OF COLUMN TABL$J_4.DOCSUM;
  DECLARE VARIABLE P_KRD TYPE OF COLUMN TABL$J_4.DOCSUM;
BEGIN
  DATE_FROM = :Q_DATE_FROM;
  DATE_TO   = :Q_DATE_TO;
  FIRM_IDS  = :Q_FIRM_IDS;
  SELECT COALESCE(SUM(P.CND_VALUE),0)
  FROM   TABL$P_CND P
  WHERE  (:FIRM_IDS CONTAINING '~'||P.FIRM_ID||'~')
    AND  (P.DATE_COMMIT < :DATE_FROM)
    AND  ((P.ACC_ID_DEB+0) = 3771)
  INTO   :P_DEB;
  SELECT COALESCE(SUM(P.CND_VALUE),0)
  FROM   TABL$P_CND P
  WHERE  (:FIRM_IDS CONTAINING '~'||P.FIRM_ID||'~')
    AND  (P.DATE_COMMIT < :DATE_FROM)
    AND  ((P.ACC_ID_KRED+0) = 3771)
  INTO   :P_KRD;
  S3771BEG = :P_DEB - :P_KRD;
  DATE_COMMIT = :DATE_FROM;
  WHILE(:DATE_COMMIT < :DATE_TO)DO
    BEGIN
    SELECT COALESCE(SUM(P.CND_VALUE),0)
    FROM   TABL$P_CND P
    WHERE  (:FIRM_IDS CONTAINING '~'||P.FIRM_ID||'~')
      AND  (P.DATE_COMMIT BETWEEN :DATE_COMMIT AND DATEADD(1 DAY TO :DATE_COMMIT))
      AND  ((P.ACC_ID_DEB+0) = 3771)
    INTO   :S3771DEB;
    SELECT COALESCE(SUM(P.CND_VALUE),0)
    FROM   TABL$P_CND P
    WHERE  (:FIRM_IDS CONTAINING '~'||P.FIRM_ID||'~')
      AND  (P.DATE_COMMIT BETWEEN :DATE_COMMIT AND DATEADD(1 DAY TO :DATE_COMMIT))
      AND  ((P.ACC_ID_KRED+0) = 3771)
    INTO   :S3771KRD;
    S3771END    = :S3771BEG + :S3771DEB - :S3771KRD;
    S3771KRD_   = 0 - :S3771KRD;
    S3771END_10 = :S3771END / 10;
    S3771IDX    = :S3771DEB - :S3771KRD;
    SUSPEND;
    S3771BEG = :S3771END;
    DATE_COMMIT = DATEADD(1 DAY TO :DATE_COMMIT);
    END
END
