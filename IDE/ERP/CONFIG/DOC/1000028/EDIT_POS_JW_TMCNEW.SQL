EXECUTE BLOCK (
  Q_J_ID           TYPE OF COLUMN TABL$J_4.ID             = ?ID
 ,Q_TMC_GROUP_ID   TYPE OF COLUMN TABL$R_TMC.TMC_GROUP_ID = ?TMC_GROUP_ID
 ,Q_COUNTRY_ID     TYPE OF COLUMN TABL$R_TMC.COUNTRY_ID   = ?COUNTRY_ID
 ,Q_PROBE          TYPE OF COLUMN TABL$R_TMC.PROBE        = ?PROBE
 ,Q_MASSA          TYPE OF COLUMN TABL$R_TMC.MASSA        = ?MASSA
 ,Q_MASSA_NETTO    TYPE OF COLUMN TABL$R_TMC.MASSA_NETTO  = ?MASSA_NETTO
 ,Q_COUNTRIESTP_ID TYPE OF COLUMN TABL$R_COUNTRIESTP.ID   = ?COUNTRIESTP_ID
)RETURNS(
  J_ID             TYPE OF COLUMN TABL$J_4.ID
)AS
  DECLARE VARIABLE P_ID             TYPE OF COLUMN TABL$D_1000014.ID;
  DECLARE VARIABLE P_TMC_ID         TYPE OF COLUMN TABL$J_4.FIRM_ID;
  DECLARE VARIABLE P_TMC_GROUP_NAME TYPE OF COLUMN TABL$R_TMC_GROUP.NAME;
  DECLARE VARIABLE P_PRICE          TYPE OF COLUMN TABL$R_TMC_P.PRICE;
BEGIN
  J_ID = :Q_J_ID;
  SELECT FIRST 1 TG.NAME FROM TABL$R_TMC_GROUP TG WHERE (TG.ID = :Q_TMC_GROUP_ID) INTO :P_TMC_GROUP_NAME;

  INSERT INTO TABL$R_TMC (NAME, FLAG_DELETE, FLAG_LOCKED, ARTICLE, NUMSHOW, EDIZM_ID,
    TMC_GROUP_ID, TMC_TYPE_ID, TMC_LIST_ID, TMC_BRAND_ID, DEV_TMC_BRAND_ID, TMC_CTGR_ID, LGTH, DIAM,
    COUNTRY_ID, PROBE, MASSA, MASSA_NETTO
  )VALUES (:P_TMC_GROUP_NAME, 0,0,'','',1000000, :Q_TMC_GROUP_ID, 2, 0, 0, 0, 0, 0, 0,
    :Q_COUNTRY_ID, :Q_PROBE, :Q_MASSA, :Q_MASSA_NETTO
  )RETURNING ID INTO :P_TMC_ID;

  SELECT FIRST 1 COALESCE((:Q_MASSA_NETTO * CE.KURS), 0) AS PRICE
  FROM   TABL$R_COUNTRIESEX CE
  WHERE  ((CE.COUNTRY_ID+0) = :Q_COUNTRY_ID)
    AND  (TRIM(CE.NAME)     = :Q_PROBE)
    AND  (CE.COUNTRIESTP_ID = :Q_COUNTRIESTP_ID)
  INTO   :P_PRICE;IF(:P_PRICE IS NULL)THEN P_PRICE = 0; 
  P_PRICE = ROUND(:P_PRICE, 2);
  IF(:P_PRICE IS NULL)THEN P_PRICE = 0;

  INSERT INTO TABL$D_1000014(J_ID,TMC_ID,PRICE,PRICE_TMC,QUANT)
    VALUES(:J_ID, :P_TMC_ID, :P_PRICE, :P_PRICE, 1)
    RETURNING ID INTO :P_ID;

  UPDATE TABL$D_1000014 D SET D.PRICE = :P_PRICE WHERE (D.ID = :P_ID);

  SUSPEND;
END
