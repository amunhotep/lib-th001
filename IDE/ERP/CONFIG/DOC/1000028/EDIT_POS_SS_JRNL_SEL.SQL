EXECUTE BLOCK (
  Q_J_ID TYPE OF COLUMN TABL$J_4.ID = ?ID
)RETURNS (
  ID                    TYPE OF COLUMN TABL$J_4.ID,
  NAME                  TYPE OF COLUMN TABL$J_4.NAME,
  FLAG_DELETE           TYPE OF COLUMN TABL$J_4.FLAG_DELETE,
  FLAG_COMMIT           TYPE OF COLUMN TABL$J_4.FLAG_COMMIT,
  TYPE_ID               TYPE OF COLUMN TABL$J_4.TYPE_ID,
  TYPE_NAME             TYPE OF COLUMN TABL$_TB_DOCS.NAME,
  COLOR_FRG             TYPE OF COLUMN TABL$_TB_DOCS.COLOR_FRG,
  COLOR_BGR             TYPE OF COLUMN TABL$_TB_DOCS.COLOR_BGR,
  DOCNUMBER             TYPE OF COLUMN TABL$J_4.DOCNUMBER,
  DOCSUM                TYPE OF COLUMN TABL$J_4.DOCSUM,
  DOCSUMVAL             TYPE OF COLUMN TABL$J_4.DOCSUMVAL,
  VALUTE_ID             TYPE OF COLUMN TABL$J_4.VALUTE_ID,
  VALUTE_NAME           TYPE OF COLUMN TABL$R_COUNTRIES.VALUTE,
  VALUTE_SHORT          TYPE OF COLUMN TABL$R_COUNTRIES.VALUTE_SHORT,
  FIRM_ID               TYPE OF COLUMN TABL$J_4.FIRM_ID,
  FIRM_NAME             TYPE OF COLUMN TABL$R_FIRMS.NAME,
  FILIAL_ID             TYPE OF COLUMN TABL$J_4.FILIAL_ID,
  FILIAL_NAME           TYPE OF COLUMN TABL$R_FILIALS.NAME,
  FILIAL_PREFIX         TYPE OF COLUMN TABL$R_FILIALS.PREFIX,
  FILIAL_GUID           TYPE OF COLUMN TABL$R_FILIALS.GUID,
  FILIAL_DATABASE_NAME  TYPE OF COLUMN TABL$R_FILIALS.DATABASE_NAME,
  FILIAL_ADDRESS        TYPE OF COLUMN TABL$R_FILIALS.ADDRESS,
  FILIAL_PHONE          TYPE OF COLUMN TABL$R_FILIALS.PHONE,
  FILIAL_COMMAND_ID     TYPE OF COLUMN TABL$R_FILIALS.COMMAND_ID,
  FILIAL_WRK_ID         TYPE OF COLUMN TABL$R_FILIALS.WRK_ID,
  FILIAL_GRAPHIK        TYPE OF COLUMN TABL$R_FILIALS.GRAPHIK,
  USER_ID               TYPE OF COLUMN TABL$J_4.USER_ID,
  USER_NAME             TYPE OF COLUMN TABL$_USERS.NAME,
  WRK_DOVER             TYPE OF COLUMN TABL$R_WRK.DOVER,
  DATE_COMMIT           TYPE OF COLUMN TABL$J_4.DATE_COMMIT,
  DOCNUMBERSTR          TYPE OF COLUMN TABL$J_4.DOCNUMBERSTR,
  DOCSTR                TYPE OF COLUMN TABL$J_4.DOCSTR,
  CS_ID                 TYPE OF COLUMN TABL$J_1000014.CS_ID,
  CS_NAME               TYPE OF COLUMN TABL$R_CS.NAME,
  CS_INN                TYPE OF COLUMN TABL$R_CS.INN,
  CS_AMOUNT             TYPE OF COLUMN TABL$R_CS_P.AMOUNT,
  CS_ADDR_ID            TYPE OF COLUMN TABL$J_1000014.CS_ADDR_ID,
  CS_ADDR_NAME          TYPE OF COLUMN TABL$R_CS_ADDR.NAME,
  CS_DOC_ID             TYPE OF COLUMN TABL$J_1000014.CS_DOC_ID,
  CS_DOC_NAME           TYPE OF COLUMN TABL$R_CS_DOCS.NAME,
  PLACE_ID              TYPE OF COLUMN TABL$J_1000014.PLACE_ID,
  PLACE_NAME            TYPE OF COLUMN TABL$R_PLACES.NAME,
  TAX_ID                TYPE OF COLUMN TABL$J_1000014.TAX_ID,
  TO_PLACE_ID           TYPE OF COLUMN TABL$J_1000014.TO_PLACE_ID,
  TO_PLACE_NAME         TYPE OF COLUMN TABL$R_PLACES.NAME,
  WRK_ID                TYPE OF COLUMN TABL$J_1000014.WRK_ID,
  WRK_NAME              TYPE OF COLUMN TABL$R_WRK.NAME,
  TMC_GRID_ID           TYPE OF COLUMN TABL$J_1000014.TMC_GRID_ID,
  P_SUM                 TYPE OF COLUMN TABL$J_4.DOCSUM,
  P_NDP                 TYPE OF COLUMN TABL$J_4.DOCSUM,
  P_SUMNDP              TYPE OF COLUMN TABL$J_4.DOCSUM,
  J_1000026_ID          TYPE OF COLUMN TABL$J_4.ID,
  J_1000026_DOCSUM      TYPE OF COLUMN TABL$J_4.DOCSUM,
  J_1000026_DOCSUMDIFF  TYPE OF COLUMN TABL$J_4.DOCSUM
  )
AS
  DECLARE VARIABLE P_CS_ADDR_ID TYPE OF COLUMN TABL$R_CS_ADDR.ID;
  DECLARE VARIABLE P_VAL_DATE   TYPE OF COLUMN TABL$R_CS.VALUE_DATE;
BEGIN
  SELECT FIRST 1 PR.ID, PR.NAME, PR.FLAG_DELETE, PR.FLAG_COMMIT, PR.TYPE_ID, PR.TYPE_NAME, PR.COLOR_FRG, PR.COLOR_BGR,
         PR.DOCNUMBER, PR.DOCSUM, PR.DOCSUMVAL, PR.VALUTE_ID, PR.VALUTE_NAME, PR.VALUTE_SHORT, PR.FIRM_ID, PR.FIRM_NAME,
         PR.FILIAL_ID, PR.FILIAL_NAME, PR.USER_ID, PR.USER_NAME, PR.WRK_DOVER, PR.DATE_COMMIT, PR.DOCNUMBERSTR,PR.DOCSTR,
           PR.FILIAL_PREFIX, PR.FILIAL_GUID, PR.FILIAL_DATABASE_NAME, PR.FILIAL_ADDRESS, PR.FILIAL_PHONE,
           PR.FILIAL_COMMAND_ID, PR.FILIAL_WRK_ID, PR.FILIAL_GRAPHIK,
         JB.CS_ID, CS.NAME, CS.INN, JB.CS_ADDR_ID, JB.CS_DOC_ID, JB.PLACE_ID, PLACE.NAME, JB.TAX_ID, JB.TO_PLACE_ID,
         (SELECT FIRST 1 COALESCE(PL.NAME,'') FROM TABL$R_PLACES PL WHERE (PL.ID = JB.TO_PLACE_ID)) AS TO_PLACE_NAME,
         JB.TMC_GRID_ID, JB.WRK_ID, JB.P_SUM, JB.P_NDP, JB.P_SUMNDP
  FROM   PROC$D_4(:Q_J_ID) PR, TABL$J_1000014 JB, TABL$R_CS CS, TABL$R_PLACES PLACE
  WHERE  (JB.J_ID = PR.ID)
    AND  (CS.ID = JB.CS_ID)
    AND  (PLACE.ID = JB.PLACE_ID)
  INTO   :ID, :NAME, :FLAG_DELETE, :FLAG_COMMIT, :TYPE_ID, :TYPE_NAME, :COLOR_FRG, :COLOR_BGR,
         :DOCNUMBER, :DOCSUM, :DOCSUMVAL, :VALUTE_ID, :VALUTE_NAME, :VALUTE_SHORT, :FIRM_ID, :FIRM_NAME,
         :FILIAL_ID, :FILIAL_NAME, :USER_ID, :USER_NAME, :WRK_DOVER, :DATE_COMMIT, :DOCNUMBERSTR,:DOCSTR,
         :FILIAL_PREFIX, :FILIAL_GUID, :FILIAL_DATABASE_NAME, :FILIAL_ADDRESS, :FILIAL_PHONE,
         :FILIAL_COMMAND_ID, :FILIAL_WRK_ID, :FILIAL_GRAPHIK,
         :CS_ID, :CS_NAME, :CS_INN, :CS_ADDR_ID, :CS_DOC_ID, :PLACE_ID, :PLACE_NAME, :TAX_ID, :TO_PLACE_ID, :TO_PLACE_NAME,
         :TMC_GRID_ID, :WRK_ID, :P_SUM, :P_NDP, :P_SUMNDP
         ;

  P_CS_ADDR_ID = :CS_ADDR_ID;
  IF((:CS_ADDR_ID IS NULL)OR(:CS_ADDR_ID = 0))THEN
    SELECT FIRST 1 CSA.ID FROM TABL$R_CS_ADDR CSA WHERE(CSA.CS_ID = :CS_ID) INTO :P_CS_ADDR_ID;
  SELECT FIRST 1 PR.ADDRESS_NAME_FULL FROM PROC$R_CS_ADDR_GET(:P_CS_ADDR_ID) PR INTO :CS_ADDR_NAME;
  CS_DOC_NAME = '';
  SELECT FIRST 1 P.DOC_NAME FROM PROC$R_CS_DOCS_GEITEM(:CS_DOC_ID) P INTO :CS_DOC_NAME;

  SELECT FIRST 1 COALESCE(W.NAME,'')
  FROM   TABL$R_WRK W
  WHERE  (W.ID = :WRK_ID)
  INTO   :WRK_NAME;

  SELECT MAX(P.VALUE_DATE)
  FROM   TABL$R_CS_P P
  WHERE  (P.CS_ID = :CS_ID)
    AND  (P.VALUE_DATE <= CURRENT_TIMESTAMP)
  INTO   :P_VAL_DATE;

  IF(:P_VAL_DATE IS NULL)THEN
    BEGIN
    CS_AMOUNT = 0.000;
    END
   ELSE
    BEGIN
    SELECT FIRST 1 PW.AMOUNT
    FROM   TABL$R_CS_P PW
    WHERE  (PW.CS_ID = :CS_ID)
      AND  (PW.VALUE_DATE = :P_VAL_DATE)
    INTO   :CS_AMOUNT;
    END
  J_1000026_ID         = 0;
  J_1000026_DOCSUM     = 0;
  J_1000026_DOCSUMDIFF = 0;
  SELECT COALESCE(MIN(J.ID),0)
  FROM   TABL$J_CHILDS JC, TABL$J_4 J
  WHERE  (JC.J_ID = :ID)
    AND  (J.ID = JC.J_CHILD_ID)
    AND  (J.TYPE_ID = 1000026)
  INTO   :J_1000026_ID; IF(:J_1000026_ID IS NULL)THEN J_1000026_ID = 0;
  SELECT FIRST 1 COALESCE(J.DOCSUM,0) FROM TABL$J_4 J WHERE(J.ID = :J_1000026_ID)INTO :J_1000026_DOCSUM;
  J_1000026_DOCSUMDIFF = :DOCSUM - :J_1000026_DOCSUM;
  SUSPEND;
END
