EXECUTE BLOCK AS
  DECLARE VARIABLE Q_J_ID   TYPE OF COLUMN TABL$J_4.ID;
  DECLARE VARIABLE Q_J62_ID TYPE OF COLUMN TABL$J_4.ID;
  DECLARE VARIABLE P_J64_ID TYPE OF COLUMN TABL$J_4.ID;
  DECLARE VARIABLE P_TMC_ID TYPE OF COLUMN TABL$D_1000032.TMC_ID;
  DECLARE VARIABLE P_PRICE  TYPE OF COLUMN TABL$D_1000032.TMC_ID;
  DECLARE VARIABLE P_QUANT  TYPE OF COLUMN TABL$D_1000032.TMC_ID;
BEGIN
  Q_J_ID   = ?J_ID ;
  Q_J62_ID = ?J62_ID ;
  
  SELECT FIRST 1 J4.ID
  FROM   TABL$J_CHILDS JC, TABL$J_4 J4
  WHERE  (JC.J_ID = :Q_J62_ID)
    AND  (J4.ID = JC.J_CHILD_ID)
    AND  (J4.TYPE_ID = 1000064)
    AND  (J4.FLAG_COMMIT = 1)
  INTO   :P_J64_ID;

  FOR
    SELECT D.TMC_ID, D.QUANT
           ,(SELECT FIRST 1 P.PRICE FROM TABL$R_TMC_P P WHERE (P.TMC_ID = TMC.ID)AND(P.VALUE_DATE = TMC.VALUE_DATE))
    FROM   TABL$D_1000014 D, TABL$R_TMC TMC
    WHERE  (D.J_ID = :P_J64_ID)
      AND  (TMC.ID = D.TMC_ID)
    INTO   :P_TMC_ID, :P_QUANT, :P_PRICE
  DO
    INSERT INTO TABL$D_1000032(J_ID, TMC_ID, PRICE, QUANT, J_1000062_ID)
      VALUES(:Q_J_ID, :P_TMC_ID, :P_PRICE, :P_QUANT, :Q_J62_ID);
END
