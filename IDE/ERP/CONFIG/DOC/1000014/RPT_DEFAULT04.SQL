EXECUTE BLOCK (
  Q_J_ID TYPE OF COLUMN TABL$J_4.ID = ?J_ID
)RETURNS (
   ID                     TYPE OF COLUMN TABL$D_1000014.ID
  ,NAME                   TYPE OF COLUMN TABL$D_1000014.NAME
  ,FLAG_DELETE            TYPE OF COLUMN TABL$D_1000014.FLAG_DELETE
  ,J_ID                   TYPE OF COLUMN TABL$D_1000014.J_ID
  ,TMC_ID                 TYPE OF COLUMN TABL$D_1000014.TMC_ID
  ,TMC_FLAG_LOCKED        TYPE OF COLUMN TABL$R_TMC.FLAG_LOCKED
  ,FLAG_LOCKED            TYPE OF COLUMN TABL$R_TMC.FLAG_LOCKED
  ,TMC_LIST_ID            TYPE OF COLUMN TABL$R_TMC.TMC_LIST_ID
  ,TMC_NAME               TYPE OF COLUMN TABL$R_TMC.NAME
  ,TMC_NAME2              TYPE OF COLUMN TABL$R_TMC.NAME2
  ,TMC_ARTICLE            TYPE OF COLUMN TABL$R_TMC.ARTICLE
  ,ARTICLE                TYPE OF COLUMN TABL$R_TMC.ARTICLE
  ,TMC_NUMSHOW            TYPE OF COLUMN TABL$R_TMC.NUMSHOW
  ,TMC_BARCODE            TYPE OF COLUMN TABL$R_TMC.BARCODE
  ,BARCODE                TYPE OF COLUMN TABL$R_TMC.BARCODE
  ,TMC_VEDCODE            TYPE OF COLUMN TABL$R_TMC.VEDCODE
  ,TMC_MODELNAME          TYPE OF COLUMN TABL$R_TMC.MODELNAME
  ,TMC_CTGR_ID            TYPE OF COLUMN TABL$R_TMC.TMC_CTGR_ID
  ,TMC_CTGR_NAME          TYPE OF COLUMN TABL$R_TMC_CTGR.NAME
  ,TMC_CTGR_PATH          TYPE OF COLUMN TABL$R_TMC_CTGR.PATH
  ,TMC_EDIZM_ID           TYPE OF COLUMN TABL$R_TMC.EDIZM_ID
  ,TMC_EDIZM_NAME         TYPE OF COLUMN TABL$R_EDIZM.NAME
  ,TMC_EDIZM_SHORT        TYPE OF COLUMN TABL$R_EDIZM.SHORT_NAME
  ,TMC_GROUP_ID           TYPE OF COLUMN TABL$R_TMC.TMC_GROUP_ID
  ,TMC_GROUP_NAME         TYPE OF COLUMN TABL$R_TMC_GROUP.NAME
  ,TMC_COUNTRY_ID         TYPE OF COLUMN TABL$R_TMC.COUNTRY_ID
  ,TMC_VALUTE_NAME        TYPE OF COLUMN TABL$R_COUNTRIES.VALUTE
  ,TMC_PROBE              TYPE OF COLUMN TABL$R_TMC.PROBE
  ,TMC_LGTH               TYPE OF COLUMN TABL$R_TMC.LGTH
  ,TMC_DIAM               TYPE OF COLUMN TABL$R_TMC.DIAM
  ,TMC_MASSA              TYPE OF COLUMN TABL$R_TMC.MASSA
  ,TMC_MASSA_INS          TYPE OF COLUMN TABL$R_TMC.MASSA
  ,TMC_MASSA_NETTO        TYPE OF COLUMN TABL$R_TMC.MASSA_NETTO
  ,TMC_MASSA_T            TYPE OF COLUMN TABL$R_TMC.MASSA
  ,TMC_MASSA_INS_T        TYPE OF COLUMN TABL$R_TMC.MASSA
  ,TMC_MASSA_NETTO_T      TYPE OF COLUMN TABL$R_TMC.MASSA_NETTO
  ,TMC_DEV_COUNTRY_ID     TYPE OF COLUMN TABL$R_TMC.DEV_COUNTRY_ID
  ,TMC_DEV_COUNTRY_NAME   TYPE OF COLUMN TABL$R_COUNTRIES.VALUTE
  ,TMC_BRAND_ID           TYPE OF COLUMN TABL$R_TMC.TMC_BRAND_ID
  ,TMC_BRAND_NAME         TYPE OF COLUMN TABL$R_TMC_BRANDS.NAME
  ,TMC_YEAR_ID            TYPE OF COLUMN TABL$R_TMC.YEAR_ID
  ,TMC_STATEFINE          TYPE OF COLUMN TABL$R_TMC.STATEFINE
  ,TMC_IMG                TYPE OF COLUMN TABL$R_TMC.IMG
  ,TMC_COMENT             TYPE OF COLUMN TABL$R_TMC.COMENT
  ,COMENT                 TYPE OF COLUMN TABL$R_TMC.COMENT
  ,PRICE_TMC              TYPE OF COLUMN TABL$D_1000014.PRICE_TMC
  ,PRICE                  TYPE OF COLUMN TABL$D_1000014.PRICE
  ,QUANT                  TYPE OF COLUMN TABL$D_1000014.QUANT
  ,TOTAL                  TYPE OF COLUMN TABL$D_1000014.PRICE
  ,NDP                    TYPE OF COLUMN TABL$D_1000014.NDP
  ,NDPTOTAL               TYPE OF COLUMN TABL$D_1000014.NDP
  ,NDPPRINT               TYPE OF COLUMN TABL$D_1000014.NDP
  ,NDPTOTALPRINT          TYPE OF COLUMN TABL$D_1000014.NDP
  ,PRICEPRINT             TYPE OF COLUMN TABL$D_1000014.PRICE
  ,TOTALPRINTWONDP        TYPE OF COLUMN TABL$D_1000014.PRICE
  ,TOTALPRINT             TYPE OF COLUMN TABL$D_1000014.PRICE
  ,ENTRYDATE              TYPE OF COLUMN TABL$D_1000014.ENTRYDATE
  ,ENTRYBILL              TYPE OF COLUMN TABL$D_1000014.ENTRYBILL
  ,WRK_ID                 TYPE OF COLUMN TABL$D_1000014.WRK_ID
  ,WRK_NAME               TYPE OF COLUMN TABL$R_WRK.NAME
  ,J_BILLS_ID             TYPE OF COLUMN TABL$D_1000014.J_BILLS_ID
)AS
  DECLARE VARIABLE P_FIRM_ID TYPE OF COLUMN TABL$J_4.FIRM_ID;
  DECLARE VARIABLE P_I       TYPE OF COLUMN TABL$J_4.ID;
BEGIN
  SELECT FIRST 1 J4.FIRM_ID FROM TABL$J_4 J4 WHERE (J4.ID = :Q_J_ID) INTO :P_FIRM_ID;
  FOR
    SELECT  DB.ID, DB.NAME, DB.FLAG_DELETE, DB.J_ID, DB.TMC_ID
           ,TMC.NAME, TMC.NAME2, TMC.ARTICLE, TMC.NUMSHOW, TMC.BARCODE, TMC.VEDCODE, TMC.MODELNAME
           ,TMC.FLAG_LOCKED
           ,TMC.TMC_CTGR_ID
           ,TMC.TMC_LIST_ID,  TMC.EDIZM_ID, E.NAME, E.SHORT_NAME
           ,TMC.TMC_GROUP_ID, TG.NAME, TMC.COUNTRY_ID
           ,(SELECT FIRST 1 C.VALUTE FROM TABL$R_COUNTRIES C WHERE (C.ID = TMC.COUNTRY_ID))
           ,TMC.PROBE, TMC.LGTH, TMC.DIAM, TMC.MASSA, (TMC.MASSA - TMC.MASSA_NETTO), TMC.MASSA_NETTO
           ,DB.WRK_ID, (SELECT FIRST 1 W.NAME FROM TABL$R_WRK W WHERE(W.ID = DB.WRK_ID))AS WRK_NAME
           ,DB.PRICE, DB.QUANT, DB.J_BILLS_ID, DB.PRICE_TMC, (DB.PRICE * DB.QUANT) AS TOTAL
           ,DB.NDP, (DB.NDP * DB.QUANT)AS NDPTOTAL, DB.ENTRYDATE, DB.ENTRYBILL
           ,TMC.DEV_COUNTRY_ID,(SELECT FIRST 1 T0007.NAME FROM TABL$R_COUNTRIES  T0007 WHERE (T0007.ID = TMC.DEV_COUNTRY_ID)) AS DEV_COUNTRY_ID_
           ,TMC.TMC_BRAND_ID  ,(SELECT FIRST 1 T0009.NAME FROM TABL$R_TMC_BRANDS T0009 WHERE (T0009.ID = TMC.TMC_BRAND_ID  )) AS TMC_BRAND_ID_
           ,TMC.YEAR_ID, TMC.STATEFINE, TMC.IMG, TMC.COMENT
    FROM   TABL$D_1000014 DB, TABL$R_TMC TMC, TABL$R_EDIZM E, TABL$R_TMC_GROUP TG
    WHERE  (DB.J_ID = :Q_J_ID)
      AND  (TMC.ID  = DB.TMC_ID)
      AND  (E.ID    = TMC.EDIZM_ID)
      AND  (TG.ID   = TMC.TMC_GROUP_ID)
    ORDER BY DB.ID  
    INTO    :ID, :NAME, :FLAG_DELETE, :J_ID, :TMC_ID
           ,:TMC_NAME, :TMC_NAME2, :TMC_ARTICLE, :TMC_NUMSHOW, :TMC_BARCODE, :TMC_VEDCODE, :TMC_MODELNAME
           ,:TMC_FLAG_LOCKED
           ,:TMC_CTGR_ID, :TMC_LIST_ID, :TMC_EDIZM_ID, :TMC_EDIZM_NAME, :TMC_EDIZM_SHORT
           ,:TMC_GROUP_ID, :TMC_GROUP_NAME, :TMC_COUNTRY_ID, :TMC_VALUTE_NAME, :TMC_PROBE, :TMC_LGTH, :TMC_DIAM
           ,:TMC_MASSA, :TMC_MASSA_INS, :TMC_MASSA_NETTO
           ,:WRK_ID, :WRK_NAME
           ,:PRICE, :QUANT, :J_BILLS_ID, :PRICE_TMC, :TOTAL
           ,:NDP, :NDPTOTAL, :ENTRYDATE, :ENTRYBILL
           ,:TMC_DEV_COUNTRY_ID, :TMC_DEV_COUNTRY_NAME
           ,:TMC_BRAND_ID      , :TMC_BRAND_NAME
           ,:TMC_YEAR_ID, :TMC_STATEFINE, :TMC_IMG, :TMC_COMENT
  DO
    BEGIN
    COMENT  = :TMC_COMENT;
    NAME    = :TMC_NAME;
    BARCODE = :TMC_BARCODE;
    ARTICLE = :TMC_ARTICLE;
    FLAG_LOCKED = :TMC_FLAG_LOCKED;
    
    SELECT FIRST 1 COALESCE(C.NAME,''), COALESCE(C.PATH,'')
    FROM   TABL$R_TMC_CTGR C
    WHERE  (C.ID = :TMC_CTGR_ID)
    INTO   :TMC_CTGR_NAME, :TMC_CTGR_PATH;
    TMC_MASSA_T       = :TMC_MASSA       * :QUANT;
    TMC_MASSA_INS_T   = :TMC_MASSA_INS   * :QUANT;
    TMC_MASSA_NETTO_T = :TMC_MASSA_NETTO * :QUANT;
    IF(:NDPTOTAL < 0)THEN
      BEGIN
      PRICEPRINT    = :PRICE + :NDP;
      NDPPRINT      = (-1) * :NDP;
      NDPTOTALPRINT = (-1) * :NDPTOTAL;
      TOTALPRINT    = :TOTAL;
      END
     ELSE
      BEGIN
      PRICEPRINT    = :PRICE;
      NDPPRINT      = :NDP;
      NDPTOTALPRINT = :NDPTOTAL;
      TOTALPRINT    = (:PRICE + :NDP) * :QUANT;
      END
    TOTALPRINTWONDP = :TOTALPRINT - :NDPTOTAL;
    IF(:QUANT > 0)THEN
      BEGIN
      P_I = 0;
      WHILE(:P_I < :QUANT)DO
        BEGIN  
        SUSPEND;
        P_I = :P_I + 1;
        END
      END  
    END
END
