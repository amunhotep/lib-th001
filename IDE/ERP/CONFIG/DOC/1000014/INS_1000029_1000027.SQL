EXECUTE BLOCK (
  Q_FIRM_ID       TYPE OF COLUMN TABL$J_4.FIRM_ID = ?FIRM_ID
 ,Q_PARENT_DOC_ID TYPE OF COLUMN TABL$J_4.ID      = ?J_ID
) RETURNS (
  J_ID       TYPE OF COLUMN TABL$J_4.ID
 ,DOCTYPE_ID TYPE OF COLUMN TABL$J_4.TYPE_ID
)AS
  DECLARE VARIABLE P_ENTCS_ID      TYPE OF COLUMN TABL$J_1000014.CS_ID;
  DECLARE VARIABLE P_NDP_PAY       TYPE OF COLUMN TABL$R_FIRMS.NDP_PAY;

  DECLARE VARIABLE P_J_ID          TYPE OF COLUMN TABL$J_4.ID;
  DECLARE VARIABLE P_PLACE_ID      TYPE OF COLUMN TABL$J_1000014.PLACE_ID;
  DECLARE VARIABLE P_TAX_ID        TYPE OF COLUMN TABL$J_1000014.TAX_ID;

  DECLARE VARIABLE P_D_ID          TYPE OF COLUMN TABL$D_1000014.ID;
  DECLARE VARIABLE P_NAME          TYPE OF COLUMN TABL$D_1000014.NAME;
  DECLARE VARIABLE P_TMC_ID        TYPE OF COLUMN TABL$D_1000014.TMC_ID;
  DECLARE VARIABLE P_TMC_PRICE     TYPE OF COLUMN TABL$D_1000014.PRICE;
  DECLARE VARIABLE P_TMC_NDPTOTAL  TYPE OF COLUMN TABL$D_1000014.NDPTOTAL;
  DECLARE VARIABLE P_PRICE_TMC     TYPE OF COLUMN TABL$D_1000014.PRICE_TMC;
  DECLARE VARIABLE P_TMC_QUANT     TYPE OF COLUMN TABL$D_1000014.QUANT;
  DECLARE VARIABLE P_TOTAL_IN      TYPE OF COLUMN TABL$D_1000014.PRICE_TMC;
  DECLARE VARIABLE P_J_BILLS_ID    TYPE OF COLUMN TABL$D_1000014.J_BILLS_ID;
  DECLARE VARIABLE P_J_ID_PARENT   TYPE OF COLUMN TABL$D_1000014.J_ID_PARENT;
  DECLARE VARIABLE P_D_ID_PARENT   TYPE OF COLUMN TABL$D_1000014.D_ID_PARENT;
BEGIN
  DOCTYPE_ID = 1000029;

  SELECT FIRST 1 F.CS_ID
  FROM   TABL$J_4 J, TABL$R_FIRMS F
  WHERE  (J.ID = :Q_PARENT_DOC_ID)
    AND  (F.ID = J.FIRM_ID)
  INTO   :P_ENTCS_ID;

  SELECT FIRST 1 JB.PLACE_ID, JB.TAX_ID
  FROM   TABL$J_4 J, TABL$J_1000014 JB
  WHERE  (J.ID = :Q_PARENT_DOC_ID)
    AND  (JB.J_ID = J.ID)
  INTO   :P_PLACE_ID, :P_TAX_ID;

  SELECT FIRST 1 COALESCE(F.NDP_PAY, 0) FROM TABL$R_FIRMS F WHERE (F.ID = :Q_FIRM_ID) INTO :P_NDP_PAY;

  SELECT FIRST 1 P.J_ID FROM PROC$J_INS_1000029(:Q_FIRM_ID, :P_PLACE_ID, NULL) P INTO :J_ID;

  UPDATE OR INSERT INTO TABL$J_1000014(J_ID, TAX_ID)VALUES(:J_ID, :P_TAX_ID)MATCHING(J_ID);

  SELECT FIRST 1 P.J_ID
  FROM   PROC$J_INS_1000014_1000014(:Q_PARENT_DOC_ID, :J_ID) P
  INTO   :P_J_ID;

  UPDATE OR INSERT INTO TABL$J_CHILDS(J_ID, J_CHILD_ID) VALUES (:Q_PARENT_DOC_ID, :J_ID) MATCHING (J_ID, J_CHILD_ID);
  SUSPEND;
END
