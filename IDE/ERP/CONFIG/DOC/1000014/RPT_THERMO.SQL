EXECUTE BLOCK RETURNS(
   J_ID                TYPE OF COLUMN TABL$D_1000014.J_ID 
  ,DATE_COMMIT_1000020 TYPE OF COLUMN TABL$J_4.DATE_COMMIT 
  ,TMC_BRAND_ID        TYPE OF COLUMN TABL$R_TMC.TMC_BRAND_ID 
  ,TMC_BRAND_NAME      TYPE OF COLUMN TABL$R_TMC_BRANDS.NAME 
  ,TMC_BRAND_TOTAL     TYPE OF COLUMN TABL$D_1000014.TOTAL 
  ,BILL_ID             TYPE OF COLUMN TABL$D_1000014.ID 
  ,BILL_TMC_ID         TYPE OF COLUMN TABL$D_1000014.TMC_ID 
  ,BILL_TMC_NAME       TYPE OF COLUMN TABL$R_TMC.NAME 
  ,BILL_TMC_NAME2      TYPE OF COLUMN TABL$R_TMC.NAME2 
  ,BILL_EDIZM_SNAME    TYPE OF COLUMN TABL$R_EDIZM.SHORT_NAME 
  ,BILL_PRICE          TYPE OF COLUMN TABL$D_1000014.PRICE 
  ,BILL_QUANT          TYPE OF COLUMN TABL$D_1000014.QUANT 
  ,BILL_TOTAL          TYPE OF COLUMN TABL$D_1000014.TOTAL 
  ,BILL_NAME           TYPE OF COLUMN TABL$D_1000014.NAME 
)AS 
BEGIN 
  J_ID = ?J_ID; 
  
  SELECT FIRST 1 MIN(J4.DATE_COMMIT)
  FROM   TABL$J_CHILDS JC, TABL$J_4 J4
  WHERE  (JC.J_ID = :J_ID)
    AND  (J4.ID = JC.J_CHILD_ID)
    AND  (J4.TYPE_ID = 1000020)
    AND  (J4.FLAG_COMMIT = 1)
  INTO   :DATE_COMMIT_1000020;
  
  FOR 
    SELECT TMC.TMC_BRAND_ID, COALESCE(SUM(DB.PRICE * DB.QUANT), 0) 
    FROM   TABL$D_1000014 DB, TABL$R_TMC TMC 
    WHERE  (DB.J_ID = :J_ID) 
     AND   (TMC.ID  = DB.TMC_ID) 
    GROUP BY TMC.TMC_BRAND_ID 
    INTO   :TMC_BRAND_ID, :TMC_BRAND_TOTAL 
  DO 
    BEGIN 
    SELECT FIRST 1 COALESCE(TB.NAME,'') FROM TABL$R_TMC_BRANDS TB 
    WHERE (TB.ID = :TMC_BRAND_ID)INTO :TMC_BRAND_NAME; 
    FOR 
      SELECT  DB.ID, DB.NAME, DB.TMC_ID, TMC.NAME, TMC.NAME2 
             ,E.SHORT_NAME, DB.PRICE, DB.QUANT, (DB.PRICE * DB.QUANT) 
      FROM    TABL$D_1000014 DB, TABL$R_TMC TMC, TABL$R_EDIZM E 
      WHERE   (DB.J_ID = :J_ID) 
        AND   (TMC.ID  = DB.TMC_ID) 
        AND   (E.ID    = TMC.EDIZM_ID) 
        AND   (TMC.TMC_BRAND_ID = :TMC_BRAND_ID) 
      ORDER BY DB.ID 
      INTO    :BILL_ID, :BILL_NAME, :BILL_TMC_ID, :BILL_TMC_NAME, :BILL_TMC_NAME2 
             ,:BILL_EDIZM_SNAME, :BILL_PRICE, :BILL_QUANT, :BILL_TOTAL 
    DO 
      BEGIN 
      SUSPEND; 
      END 
    END 
END
