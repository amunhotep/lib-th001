EXECUTE BLOCK (
  Q_FIRM_ID  TYPE OF COLUMN TABL$J_4.FIRM_ID = ?FIRM_ID
)RETURNS (
  J_ID       TYPE OF COLUMN TABL$J_4.ID
 ,DOCTYPE_ID TYPE OF COLUMN TABL$J_4.TYPE_ID
)
AS
  DECLARE VARIABLE P_PLACE_ID      TYPE OF COLUMN TABL$J_1000014.PLACE_ID;
  DECLARE VARIABLE P_CS_ID         TYPE OF COLUMN TABL$J_1000014.CS_ID;
  DECLARE VARIABLE P_CS_ADDR_ID    TYPE OF COLUMN TABL$J_1000014.CS_ADDR_ID;
  DECLARE VARIABLE P_CS_DOC_ID     TYPE OF COLUMN TABL$J_1000014.CS_DOC_ID;
  DECLARE VARIABLE P_TAX_ID        TYPE OF COLUMN TABL$J_1000014.TAX_ID;
  DECLARE VARIABLE P_WRK_ID        TYPE OF COLUMN TABL$J_1000014.WRK_ID;
  DECLARE VARIABLE P_TMC_GRID_ID   TYPE OF COLUMN TABL$J_1000014.TMC_GRID_ID;
BEGIN
  DOCTYPE_ID    = 1000131;
  P_CS_ID       = -2;
  P_CS_ADDR_ID  = 0;
  P_CS_DOC_ID   = 0;
  P_TAX_ID      = 1000010;
  P_WRK_ID      = 0;
  P_TMC_GRID_ID = 0;

  SELECT FIRST 1 PL.ID
  FROM   TABL$R_PLACES PL
  WHERE  (PL.FILIAL_ID = (SELECT FIRST 1 P.ID FROM PROC$R_FILIALS_DEFAULT P))
    AND  (PL.ACC_ID = 281)
  INTO   :P_PLACE_ID;

  SELECT FIRST 1 P.J_ID FROM PROC$J_INS_4(:Q_FIRM_ID, :DOCTYPE_ID, NULL) P INTO :J_ID;

  UPDATE OR INSERT INTO TABL$J_1000014 (J_ID, CS_ID, CS_ADDR_ID, CS_DOC_ID, PLACE_ID, TAX_ID, TO_PLACE_ID, WRK_ID, TMC_GRID_ID, J_PAY_ID)
    VALUES (:J_ID, :P_CS_ID, :P_CS_ADDR_ID, :P_CS_DOC_ID, :P_PLACE_ID, :P_TAX_ID, 0, :P_WRK_ID, :P_TMC_GRID_ID, 0)
    MATCHING(J_ID);

  SUSPEND;
END
