-- DB:CONFIG/REF/WRK/RPT_DEFAULT.SQL
EXECUTE BLOCK (
   Q_WRK_ID            TYPE OF COLUMN TABL$R_WRK.ID = ?WRK_ID
)RETURNS (
   WRK_ID              TYPE OF COLUMN TABL$R_WRK.ID
  ,WRK_NAME            TYPE OF COLUMN TABL$R_WRK.NAME
  ,WRK_FIRSTNAME       TYPE OF COLUMN TABL$R_WRK.FIRSTNAME
  ,WRK_MIDDLENAME      TYPE OF COLUMN TABL$R_WRK.MIDDLENAME
  ,WRK_LASTNAME        TYPE OF COLUMN TABL$R_WRK.LASTNAME
  ,WRK_BIRTHDATE       TYPE OF COLUMN TABL$R_WRK.BIRTHDATE
  ,WRK_BIRTHPLACE      TYPE OF COLUMN TABL$R_WRK.BIRTHPLACE
  ,WRK_USER_NAME       TYPE OF COLUMN TABL$R_WRK.USER_NAME
  ,WRK_DPA_NUMBER      TYPE OF COLUMN TABL$R_WRK.DPA_NUMBER
  ,WRK_DPA_DATE        TYPE OF COLUMN TABL$R_WRK.DPA_DATE
  ,WRK_DPA_ORG         TYPE OF COLUMN TABL$R_WRK.DPA_ORG
  ,COUNTRY_ID          TYPE OF COLUMN TABL$R_WRK_ADDR.COUNTRY_ID
  ,COUNTRY_NAME        TYPE OF COLUMN TABL$R_COUNTRIES.NAME
  ,REGION_ID           TYPE OF COLUMN TABL$R_WRK_ADDR.REGION_ID
  ,REGION_NAME         TYPE OF COLUMN TABL$R_REGIONS.NAME
  ,ADDRESS_ID          TYPE OF COLUMN TABL$R_WRK_ADDR.ID
  ,ADDRESS_ZIP         TYPE OF COLUMN TABL$R_WRK_ADDR.ZIP
  ,ADDRESS_NAME        TYPE OF COLUMN TABL$R_WRK_ADDR.NAME
  ,ADDRESS_PHONES      DOMN$BLOB_TEXT
  ,DOC_ID              TYPE OF COLUMN TABL$R_WRK_DOCS.ID
  ,DOC_NAME            TYPE OF COLUMN TABL$R_WRK_DOCS.NAME
  ,DOC_SERIAL          TYPE OF COLUMN TABL$R_WRK_DOCS.DOC_SERIAL
  ,DOC_NUMBER          TYPE OF COLUMN TABL$R_WRK_DOCS.DOC_NUMBER
  ,DOC_DATE            TYPE OF COLUMN TABL$R_WRK_DOCS.DOC_DATE
  ,DOC_DATEEND         TYPE OF COLUMN TABL$R_WRK_DOCS.DOC_DATEEND
  ,DOC_COMENT          TYPE OF COLUMN TABL$R_WRK_DOCS.COMENT
  ,DOC_TYPE_ID         TYPE OF COLUMN TABL$R_WRK_DOCS.DOCTYPE_ID
  ,DOC_TYPE_NAME       TYPE OF COLUMN TABL$R_WRK_DOCTYPES.NAME
)AS
BEGIN
  WRK_ID = :Q_WRK_ID;

  SELECT FIRST 1 CS.NAME, CS.BIRTHDATE, CS.BIRTHPLACE, CS.FIRSTNAME, CS.MIDDLENAME, CS.LASTNAME
        ,CS.DPA_NUMBER, CS.DPA_DATE, CS.DPA_ORG, CS.USER_NAME
  FROM   TABL$R_WRK CS
  WHERE  (CS.ID = :WRK_ID)
  INTO   :WRK_NAME, :WRK_BIRTHDATE, :WRK_BIRTHPLACE,:WRK_FIRSTNAME, :WRK_MIDDLENAME, :WRK_LASTNAME
        ,:WRK_DPA_NUMBER, :WRK_DPA_DATE, :WRK_DPA_ORG, :WRK_USER_NAME;

  SELECT FIRST 1 CA.ID
  FROM   TABL$R_WRK_ADDR CA
  WHERE  (CA.WRK_ID = :WRK_ID)
    AND  (CA.FLAG_JURIDICAL = 1)
  INTO   :ADDRESS_ID;

  SELECT FIRST 1 CSA.ZIP, CSA.NAME, CNTR.ID, CNTR.NAME, REGN.ID, REGN.NAME
  FROM   TABL$R_WRK_ADDR CSA, TABL$R_COUNTRIES CNTR, TABL$R_REGIONS REGN
  WHERE  (CSA.ID = :ADDRESS_ID)
    AND  (CNTR.ID = CSA.COUNTRY_ID)
    AND  (REGN.ID = CSA.REGION_ID)
  INTO   :ADDRESS_ZIP, :ADDRESS_NAME, :COUNTRY_ID, :COUNTRY_NAME, :REGION_ID, :REGION_NAME;

  SELECT LIST(P.NAME, '; ')
  FROM   TABL$R_WRK_PHONES P
  WHERE  (P.WRK_ID = :WRK_ID)
  INTO   :ADDRESS_PHONES;

  SELECT FIRST 1 CD.ID, CD.NAME, CD.DOC_SERIAL, CD.DOC_NUMBER, CD.DOC_DATE, CD.DOC_DATEEND
        ,CD.COMENT, CD.DOCTYPE_ID, DT.NAME
  FROM   TABL$R_WRK_DOCS CD, TABL$R_WRK_DOCTYPES DT
  WHERE  (CD.WRK_ID = :WRK_ID)
    AND  (DT.ID = CD.DOCTYPE_ID)
  INTO   :DOC_ID, :DOC_NAME, :DOC_SERIAL, :DOC_NUMBER, :DOC_DATE, :DOC_DATEEND
        ,:DOC_COMENT, :DOC_TYPE_ID, :DOC_TYPE_NAME;

  SUSPEND;
END
