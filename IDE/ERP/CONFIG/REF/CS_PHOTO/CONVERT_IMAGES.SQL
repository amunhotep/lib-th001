EXECUTE BLOCK RETURNS(
   CS_ID       TYPE OF COLUMN TABL$R_CS_PHOTO.CS_ID
  ,ID          TYPE OF COLUMN TABL$R_CS_PHOTO.ID
  ,NAME        TYPE OF COLUMN TABL$R_CS_PHOTO.NAME
  ,FLAG_DELETE TYPE OF COLUMN TABL$R_CS_PHOTO.FLAG_DELETE
  ,DATE_COMMIT TYPE OF COLUMN TABL$R_CS_PHOTO.DATE_COMMIT
  ,PHOTO       TYPE OF COLUMN TABL$R_CS_PHOTO.PHOTO
)AS
  DECLARE VARIABLE P_DB_BLOB  DOMN$PSTRING;
  DECLARE VARIABLE P_SQL_STMT DOMN$PSTRING;
BEGIN
  P_DB_BLOB = '';
  IF(GEN_ID(GENR$R_CS_PHOTO_EXTERNAL, 0) = 1)THEN
    BEGIN
    SELECT FIRST 1 P.DATABASE_PATH FROM PROC$_DB_PATH_BLOB P INTO :P_DB_BLOB;
    END
  FOR
    SELECT P.CS_ID, P.ID, P.NAME, P.FLAG_DELETE, P.DATE_COMMIT, P.PHOTO
    FROM   TABL$R_CS_PHOTO P
    ORDER BY P.ID
    INTO   :CS_ID, :ID, :NAME, :FLAG_DELETE, :DATE_COMMIT, :PHOTO
  DO
    BEGIN
    IF( (:P_DB_BLOB<>'') AND (:PHOTO IS NULL) )THEN
      BEGIN
      P_SQL_STMT = 'SELECT FIRST 1 P.PHOTO FROM TABL$R_CS_PHOTO P WHERE (P.ID = :P_ID) ';
      EXECUTE STATEMENT (:P_SQL_STMT)(P_ID := :ID)ON EXTERNAL DATA SOURCE :P_DB_BLOB
        AS USER 'SYSDBA' PASSWORD 'masterkey' WITH COMMON TRANSACTION INTO :PHOTO;
      END
    SUSPEND;
    END
END
