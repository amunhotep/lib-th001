EXECUTE BLOCK RETURNS(
  CNT TYPE OF COLUMN TABL$R_ENTPH_CARDS.ID
)AS
  DECLARE VARIABLE P_ID        TYPE OF COLUMN TABL$R_ENTPH_CARDS.ID;
  DECLARE VARIABLE P_CS_ID     TYPE OF COLUMN TABL$R_ENTPH_CARDS.CS_ID;
  DECLARE VARIABLE P_NAME      TYPE OF COLUMN TABL$R_ENTPH_CARDS.NAME;
  DECLARE VARIABLE P_CARDNUM   TYPE OF COLUMN TABL$R_ENTPH_CARDS.CARDNUM;
  DECLARE VARIABLE P_BIRTHDATE TYPE OF COLUMN TABL$R_ENTPH_CARDS.BIRTHDATE;
BEGIN
  CNT = 0;
  FOR
    SELECT C.ID, C.NAME, C.BIRTHDATE, C.CARDNUM
    FROM   TABL$R_ENTPH_CARDS C
    WHERE  (C.NAME <> '')
    ORDER BY C.ID
    INTO   :P_ID, :P_NAME, :P_BIRTHDATE, :P_CARDNUM
  DO
    FOR
      SELECT COALESCE(CS.ID, -1000)
      FROM   TABL$R_CS CS
      WHERE  (CS.BIRTHDAY = :P_BIRTHDATE)
        AND  (CS.NAME2 = :P_NAME)
      INTO   :P_CS_ID
    DO
      BEGIN
      UPDATE TABL$R_CS C1 SET C1.CODECARD = :P_CARDNUM WHERE (C1.ID = :P_CS_ID);
      CNT = :CNT + 1;
      END
  SUSPEND;
END
